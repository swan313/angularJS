/**
 * Created by Administrator on 2015/10/19.
 */
(function(c,b){if(typeof module==="object"&&typeof module.exports==="object"){module.exports=c.document?b(c,true):function(d){if(!d.document){throw new Error("Avalon requires a window with a document")}return b(d)}}else{b(c)}}(typeof window!=="undefined"?window:this,function(window,noGlobal){var expose=new Date-0;var DOC=window.document;var head=DOC.getElementsByTagName("head")[0];var ifGroup=head.insertBefore(document.createElement("avalon"),head.firstChild);ifGroup.innerHTML="X<style id='avalonStyle'>.avalonHide{ display: none!important }</style>";ifGroup.setAttribute("ms-skip","1");var rnative=/\[native code\]/;function log(){if(window.console&&avalon.config.debug){Function.apply.call(console.log,console,arguments)}}var subscribers="$"+expose;var otherRequire=window.require;var otherDefine=window.define;var stopRepeatAssign=false;var rword=/[^, ]+/g;var rcomplexType=/^(?:object|array)$/;var rsvg=/^\[object SVG\w*Element\]$/;var rwindow=/^\[object (?:Window|DOMWindow|global)\]$/;var oproto=Object.prototype;var ohasOwn=oproto.hasOwnProperty;var serialize=oproto.toString;var ap=Array.prototype;var aslice=ap.slice;var Registry={};var W3C=window.dispatchEvent;var root=DOC.documentElement;var hyperspace=DOC.createDocumentFragment();var cinerator=DOC.createElement("div");var class2type={};"Boolean Number String Function Array Date RegExp Object Error".replace(rword,function(name){class2type["[object "+name+"]"]=name.toLowerCase()});function noop(){}function oneObject(array,val){if(typeof array==="string"){array=array.match(rword)||[]}var result={},value=val!==void 0?val:1;for(var i=0,n=array.length;i<n;i++){result[array[i]]=value}return result}function createCache(maxLength){var keys=[];function cache(key,value){if(keys.push(key)>maxLength){delete cache[keys.shift()]}return cache[key]=value}return cache}var generateID=function(prefix){prefix=prefix||"avalon";return(prefix+Math.random()+Math.random()).replace(/0\./g,"")};function IE(){if(window.VBArray){var mode=document.documentMode;return mode?mode:window.XMLHttpRequest?7:6}else{return 0}}var IEVersion=IE();avalon=function(el){return new avalon.init(el)};avalon.init=function(el){this[0]=this.element=el};avalon.fn=avalon.prototype=avalon.init.prototype;avalon.type=function(obj){if(obj==null){return String(obj)}return typeof obj==="object"||typeof obj==="function"?class2type[serialize.call(obj)]||"object":typeof obj};var isFunction=typeof alert==="object"?function(fn){try{return/^\s*\bfunction\b/.test(fn+"")}catch(e){return false}}:function(fn){return serialize.call(fn)=="[object Function]"};avalon.isFunction=isFunction;avalon.isWindow=function(obj){if(!obj){return false}return obj==obj.document&&obj.document!=obj};function isWindow(obj){return rwindow.test(serialize.call(obj))}if(isWindow(window)){avalon.isWindow=isWindow}var enu;for(enu in avalon({})){break}var enumerateBUG=enu!=="0";avalon.isPlainObject=function(obj,key){if(!obj||avalon.type(obj)!=="object"||obj.nodeType||avalon.isWindow(obj)){return false}try{if(obj.constructor&&!ohasOwn.call(obj,"constructor")&&!ohasOwn.call(obj.constructor.prototype,"isPrototypeOf")){return false}}catch(e){return false}if(enumerateBUG){for(key in obj){return ohasOwn.call(obj,key)}}for(key in obj){}return key===void 0||ohasOwn.call(obj,key)};if(rnative.test(Object.getPrototypeOf)){avalon.isPlainObject=function(obj){return serialize.call(obj)==="[object Object]"&&Object.getPrototypeOf(obj)===oproto}}avalon.mix=avalon.fn.mix=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i++}if(typeof target!=="object"&&!isFunction(target)){target={}}if(i===length){target=this;i--}for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];try{copy=options[name]}catch(e){continue}if(target===copy){continue}if(deep&&copy&&(avalon.isPlainObject(copy)||(copyIsArray=Array.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&Array.isArray(src)?src:[]}else{clone=src&&avalon.isPlainObject(src)?src:{}}target[name]=avalon.mix(deep,clone,copy)}else{if(copy!==void 0){target[name]=copy}}}}}return target};function _number(a,len){a=Math.floor(a)||0;return a<0?Math.max(len+a,0):Math.min(a,len)}avalon.mix({rword:rword,subscribers:subscribers,version:1.391,ui:{},log:log,slice:W3C?function(nodes,start,end){return aslice.call(nodes,start,end)}:function(nodes,start,end){var ret=[];var len=nodes.length;if(end===void 0){end=len}if(typeof end==="number"&&isFinite(end)){start=_number(start,len);end=_number(end,len);for(var i=start;i<end;++i){ret[i-start]=nodes[i]}}return ret},noop:noop,error:function(str,e){throw new (e||Error)(str)},oneObject:oneObject,range:function(start,end,step){step||(step=1);if(end==null){end=start||0;start=0}var index=-1,length=Math.max(0,Math.ceil((end-start)/step)),result=Array(length);while(++index<length){result[index]=start;start+=step}return result},eventHooks:{},bind:function(el,type,fn,phase){var hooks=avalon.eventHooks;
    var hook=hooks[type];if(typeof hook==="object"){type=hook.type;if(hook.deel){fn=hook.deel(el,fn)}}var callback=W3C?fn:function(e){fn.call(el,fixEvent(e))};if(W3C){el.addEventListener(type,callback,!!phase)}else{el.attachEvent("on"+type,callback)}return callback},unbind:function(el,type,fn,phase){var hooks=avalon.eventHooks;var hook=hooks[type];var callback=fn||noop;if(typeof hook==="object"){type=hook.type}if(W3C){el.removeEventListener(type,callback,!!phase)}else{el.detachEvent("on"+type,callback)}},css:function(node,name,value){if(node instanceof avalon){node=node[0]}var prop=/[_-]/.test(name)?camelize(name):name;name=avalon.cssName(prop)||prop;if(value===void 0||typeof value==="boolean"){var fn=cssHooks[prop+":get"]||cssHooks["@:get"];if(name==="background"){name="backgroundColor"}var val=fn(node,name);return value===true?parseFloat(val)||0:val}else{if(value===""){node.style[name]=""}else{if(value==null||value!==value){return}if(isFinite(value)&&!avalon.cssNumber[prop]){value+="px"}fn=cssHooks[prop+":set"]||cssHooks["@:set"];fn(node,name,value)}}},each:function(obj,fn){if(obj){var i=0;if(isArrayLike(obj)){for(var n=obj.length;i<n;i++){if(fn(i,obj[i])===false){break}}}else{for(i in obj){if(obj.hasOwnProperty(i)&&fn(i,obj[i])===false){break}}}}},getWidgetData:function(elem,prefix){var raw=avalon(elem).data();var result={};for(var i in raw){if(i.indexOf(prefix)===0){result[i.replace(prefix,"").replace(/\w/,function(a){return a.toLowerCase()})]=raw[i]}}return result},Array:{ensure:function(target,item){if(target.indexOf(item)===-1){return target.push(item)}},removeAt:function(target,index){return !!target.splice(index,1).length},remove:function(target,item){var index=target.indexOf(item);if(~index){return avalon.Array.removeAt(target,index)}return false}}});var bindingHandlers=avalon.bindingHandlers={};var bindingExecutors=avalon.bindingExecutors={};function isArrayLike(obj){if(!obj){return false}var n=obj.length;if(n===(n>>>0)){var type=serialize.call(obj).slice(8,-1);if(/(?:regexp|string|function|window|global)$/i.test(type)){return false}if(type==="Array"){return true}try{if({}.propertyIsEnumerable.call(obj,"length")===false){return/^\s?function/.test(obj.item||obj.callee)}return true}catch(e){return !obj.eval}}return false}avalon.nextTick=window.setImmediate?setImmediate.bind(window):function(callback){setTimeout(callback,0)};if(!"司徒正美".trim){var rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(rtrim,"")}}var hasDontEnumBug=!({"toString":null}).propertyIsEnumerable("toString"),hasProtoEnumBug=(function(){}).propertyIsEnumerable("prototype"),dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],dontEnumsLength=dontEnums.length;if(!Object.keys){Object.keys=function(object){var theKeys=[];var skipProto=hasProtoEnumBug&&typeof object==="function";if(typeof object==="string"||(object&&object.callee)){for(var i=0;i<object.length;++i){theKeys.push(String(i))}}else{for(var name in object){if(!(skipProto&&name==="prototype")&&ohasOwn.call(object,name)){theKeys.push(String(name))}}}if(hasDontEnumBug){var ctor=object.constructor,skipConstructor=ctor&&ctor.prototype===object;for(var j=0;j<dontEnumsLength;j++){var dontEnum=dontEnums[j];if(!(skipConstructor&&dontEnum==="constructor")&&ohasOwn.call(object,dontEnum)){theKeys.push(dontEnum)}}}return theKeys}}if(!Array.isArray){Array.isArray=function(a){return serialize.call(a)==="[object Array]"}}if(!noop.bind){Function.prototype.bind=function(scope){if(arguments.length<2&&scope===void 0){return this}var fn=this,argv=arguments;return function(){var args=[],i;for(i=1;i<argv.length;i++){args.push(argv[i])}for(i=0;i<arguments.length;i++){args.push(arguments[i])}return fn.apply(scope,args)}}}function iterator(vars,body,ret){var fun="for(var "+vars+"i=0,n = this.length; i < n; i++){"+body.replace("_","((i in this) && fn.call(scope,this[i],i,this))")+"}"+ret;return Function("fn,scope",fun)}if(!rnative.test([].map)){avalon.mix(ap,{indexOf:function(item,index){var n=this.length,i=~~index;if(i<0){i+=n}for(;i<n;i++){if(this[i]===item){return i}}return -1},lastIndexOf:function(item,index){var n=this.length,i=index==null?n-1:index;if(i<0){i=Math.max(0,n+i)}for(;i>=0;i--){if(this[i]===item){return i}}return -1},forEach:iterator("","_",""),filter:iterator("r=[],j=0,","if(_)r[j++]=this[i]","return r"),map:iterator("r=[],","r[i]=_","return r"),some:iterator("","if(_)return true","return false"),every:iterator("","if(!_)return false","return true")})}function fixContains(root,el){try{while((el=el.parentNode)){if(el===root){return true}}return false}catch(e){return false}}avalon.contains=fixContains;if(!root.contains){Node.prototype.contains=function(arg){return !!(this.compareDocumentPosition(arg)&16)}}if(!DOC.contains){DOC.contains=function(b){return fixContains(DOC,b)}}function outerHTML(){return new XMLSerializer().serializeToString(this)}if(window.SVGElement){var svgns="http://www.w3.org/2000/svg";
    var svg=DOC.createElementNS(svgns,"svg");svg.innerHTML='<circle cx="50" cy="50" r="40" fill="red" />';if(!rsvg.test(svg.firstChild)){function enumerateNode(node,targetNode){if(node&&node.childNodes){var nodes=node.childNodes;for(var i=0,el;el=nodes[i++];){if(el.tagName){var svg=DOC.createElementNS(svgns,el.tagName.toLowerCase());ap.forEach.call(el.attributes,function(attr){svg.setAttribute(attr.name,attr.value)});enumerateNode(el,svg);targetNode.appendChild(svg)}}}}Object.defineProperties(SVGElement.prototype,{"outerHTML":{enumerable:true,configurable:true,get:outerHTML,set:function(html){var tagName=this.tagName.toLowerCase(),par=this.parentNode,frag=avalon.parseHTML(html);if(tagName==="svg"){par.insertBefore(frag,this)}else{var newFrag=DOC.createDocumentFragment();enumerateNode(frag,newFrag);par.insertBefore(newFrag,this)}par.removeChild(this)}},"innerHTML":{enumerable:true,configurable:true,get:function(){var s=this.outerHTML;var ropen=new RegExp("<"+this.nodeName+'\\b(?:(["\'])[^"]*?(\\1)|[^>])*>',"i");var rclose=new RegExp("</"+this.nodeName+">$","i");return s.replace(ropen,"").replace(rclose,"")},set:function(html){if(avalon.clearHTML){avalon.clearHTML(this);var frag=avalon.parseHTML(html);enumerateNode(frag,this)}}}})}}if(!root.outerHTML&&window.HTMLElement){HTMLElement.prototype.__defineGetter__("outerHTML",outerHTML)}var rmouseEvent=/^(?:mouse|contextmenu|drag)|click/;function fixEvent(event){var ret={};for(var i in event){ret[i]=event[i]}var target=ret.target=event.srcElement;if(event.type.indexOf("key")===0){ret.which=event.charCode!=null?event.charCode:event.keyCode}else{if(rmouseEvent.test(event.type)){var doc=target.ownerDocument||DOC;var box=doc.compatMode==="BackCompat"?doc.body:doc.documentElement;ret.pageX=event.clientX+(box.scrollLeft>>0)-(box.clientLeft>>0);ret.pageY=event.clientY+(box.scrollTop>>0)-(box.clientTop>>0);ret.wheelDeltaY=ret.wheelDelta;ret.wheelDeltaX=0}}ret.timeStamp=new Date-0;ret.originalEvent=event;ret.preventDefault=function(){event.returnValue=false};ret.stopPropagation=function(){event.cancelBubble=true};return ret}var eventHooks=avalon.eventHooks;if(!("onmouseenter" in root)){avalon.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(origType,fixType){eventHooks[origType]={type:fixType,deel:function(elem,fn){return function(e){var t=e.relatedTarget;if(!t||(t!==elem&&!(elem.compareDocumentPosition(t)&16))){delete e.type;e.type=origType;return fn.call(elem,e)}}}}})}avalon.each({AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"},function(construct,fixType){if(window[construct]&&!eventHooks.animationend){eventHooks.animationend={type:fixType}}});if(!("oninput" in DOC.createElement("input"))){eventHooks.input={type:"propertychange",deel:function(elem,fn){return function(e){if(e.propertyName==="value"){e.type="input";return fn.call(elem,e)}}}}}if(DOC.onmousewheel===void 0){var fixWheelType=DOC.onwheel!==void 0?"wheel":"DOMMouseScroll";var fixWheelDelta=fixWheelType==="wheel"?"deltaY":"detail";eventHooks.mousewheel={type:fixWheelType,deel:function(elem,fn){return function(e){e.wheelDeltaY=e.wheelDelta=e[fixWheelDelta]>0?-120:120;e.wheelDeltaX=0;if(Object.defineProperty){Object.defineProperty(e,"type",{value:"mousewheel"})}fn.call(elem,e)}}}}function kernel(settings){for(var p in settings){if(!ohasOwn.call(settings,p)){continue}var val=settings[p];if(typeof kernel.plugins[p]==="function"){kernel.plugins[p](val)}else{if(typeof kernel[p]==="object"){avalon.mix(kernel[p],val)}else{kernel[p]=val}}}return this}var openTag,closeTag,rexpr,rexprg,rbind,rregexp=/[-.*+?^${}()|[\]\/\\]/g;function escapeRegExp(target){return(target+"").replace(rregexp,"\\$&")}var innerRequire=noop;var plugins={loader:function(builtin){window.define=builtin?innerRequire.define:otherDefine;window.require=builtin?innerRequire:otherRequire},interpolate:function(array){openTag=array[0];closeTag=array[1];if(openTag===closeTag){throw new SyntaxError("openTag!==closeTag")}else{if(array+""==="<!--,-->"){kernel.commentInterpolate=true}else{var test=openTag+"test"+closeTag;cinerator.innerHTML=test;if(cinerator.innerHTML!==test&&cinerator.innerHTML.indexOf("&lt;")>-1){throw new SyntaxError("此定界符不合法")}cinerator.innerHTML=""}}var o=escapeRegExp(openTag),c=escapeRegExp(closeTag);rexpr=new RegExp(o+"(.*?)"+c);rexprg=new RegExp(o+"(.*?)"+c,"g");rbind=new RegExp(o+".*?"+c+"|\\sms-")}};kernel.debug=true;kernel.plugins=plugins;kernel.plugins["interpolate"](["{{","}}"]);kernel.paths={};kernel.shim={};kernel.maxRepeatSize=100;avalon.config=kernel;var EventBus={$watch:function(type,callback){if(typeof callback==="function"){var callbacks=this.$events[type];if(callbacks){callbacks.push(callback)}else{this.$events[type]=[callback]}}else{this.$events=this.$watch.backup}return this},$unwatch:function(type,callback){var n=arguments.length;if(n===0){this.$watch.backup=this.$events;this.$events={}}else{if(n===1){this.$events[type]=[]}else{var callbacks=this.$events[type]||[];var i=callbacks.length;while(~--i<0){if(callbacks[i]===callback){return callbacks.splice(i,1)
}}}}return this},$fire:function(type){var special;if(/^(\w+)!(\S+)$/.test(type)){special=RegExp.$1;type=RegExp.$2}var events=this.$events;var args=aslice.call(arguments,1);var detail=[type].concat(args);if(special==="all"){for(var i in avalon.vmodels){var v=avalon.vmodels[i];if(v!==this){v.$fire.apply(v,detail)}}}else{if(special==="up"||special==="down"){var elements=events.expr?findNodes(events.expr):[];if(elements.length===0){return}for(var i in avalon.vmodels){var v=avalon.vmodels[i];if(v!==this){if(v.$events.expr){var eventNodes=findNodes(v.$events.expr);if(eventNodes.length===0){continue}Array.prototype.forEach.call(eventNodes,function(node){Array.prototype.forEach.call(elements,function(element){var ok=special==="down"?element.contains(node):node.contains(element);if(ok){node._avalon=v}})})}}}var nodes=DOC.getElementsByTagName("*");var alls=[];Array.prototype.forEach.call(nodes,function(el){if(el._avalon){alls.push(el._avalon);el._avalon="";el.removeAttribute("_avalon")}});if(special==="up"){alls.reverse()}for(var i=0,el;el=alls[i++];){if(el.$fire.apply(el,detail)===false){break}}}else{var callbacks=events[type]||[];var all=events.$all||[];for(var i=0,callback;callback=callbacks[i++];){if(isFunction(callback)){callback.apply(this,args)}}for(var i=0,callback;callback=all[i++];){if(isFunction(callback)){callback.apply(this,arguments)}}}}}};var ravalon=/(\w+)\[(avalonctrl)="(\S+)"\]/;var findNodes=DOC.querySelectorAll?function(str){return DOC.querySelectorAll(str)}:function(str){var match=str.match(ravalon);var all=DOC.getElementsByTagName(match[1]);var nodes=[];for(var i=0,el;el=all[i++];){if(el.getAttribute(match[2])===match[3]){nodes.push(el)}}return nodes};var VMODELS=avalon.vmodels={};avalon.define=function(id,factory){var $id=id.$id||id;if(!$id){log("warning: vm必须指定$id")}if(VMODELS[$id]){log("warning: "+$id+" 已经存在于avalon.vmodels中")}if(typeof id==="object"){var model=modelFactory(id)}else{var scope={$watch:noop};factory(scope);model=modelFactory(scope);stopRepeatAssign=true;factory(model);stopRepeatAssign=false}model.$id=$id;return VMODELS[$id]=model};var $$skipArray=String("$id,$watch,$unwatch,$fire,$events,$model,$skipArray").match(rword);function isObservable(name,value,$skipArray){if(isFunction(value)||value&&value.nodeType){return false}if($skipArray.indexOf(name)!==-1){return false}if($$skipArray.indexOf(name)!==-1){return false}var $special=$skipArray.$special;if(name&&name.charAt(0)==="$"&&!$special[name]){return false}return true}var midway={};function getNewValue(accessor,name,value,$vmodel){switch(accessor.type){case 0:var getter=accessor.get;var setter=accessor.set;if(isFunction(setter)){var $events=$vmodel.$events;var lock=$events[name];$events[name]=[];setter.call($vmodel,value);$events[name]=lock}return getter.call($vmodel);case 1:return value;case 2:if(value!==$vmodel.$model[name]){var svmodel=accessor.svmodel=objectFactory($vmodel,name,value,accessor.valueType);value=svmodel.$model;var fn=midway[svmodel.$id];fn&&fn()}return value}}var defineProperty=Object.defineProperty;var canHideOwn=true;try{defineProperty({},"_",{value:"x"});var defineProperties=Object.defineProperties}catch(e){canHideOwn=false}function modelFactory(source,$special,$model){if(Array.isArray(source)){var arr=source.concat();source.length=0;var collection=Collection(source);collection.pushArray(arr);return collection}if(typeof source.nodeType==="number"){return source}if(source.$id&&source.$events){return source}if(!Array.isArray(source.$skipArray)){source.$skipArray=[]}source.$skipArray.$special=$special||{};var $vmodel={};$model=$model||{};var $events={};var watchedProperties={};var initCallbacks=[];for(var i in source){(function(name,val){$model[name]=val;if(!isObservable(name,val,source.$skipArray)){return}$events[name]=[];var valueType=avalon.type(val);var accessor=function(newValue){var name=accessor._name;var $vmodel=this;var $model=$vmodel.$model;var oldValue=$model[name];var $events=$vmodel.$events;if(arguments.length){if(stopRepeatAssign){return}if(accessor.type!==1){newValue=getNewValue(accessor,name,newValue,$vmodel);if(!accessor.type){return}}if(!isEqual(oldValue,newValue)){$model[name]=newValue;if($events.$digest){if(!accessor.pedding){accessor.pedding=true;setTimeout(function(){notifySubscribers($events[name]);safeFire($vmodel,name,$model[name],oldValue);accessor.pedding=false})}}else{notifySubscribers($events[name]);safeFire($vmodel,name,newValue,oldValue)}}}else{if(accessor.type===0){var newValue=accessor.get.call($vmodel);if(oldValue!==newValue){$model[name]=newValue;if($events.$digest){if(!accessor.pedding){accessor.pedding=true;setTimeout(function(){safeFire($vmodel,name,$model[name],oldValue);accessor.pedding=false})}}else{safeFire($vmodel,name,newValue,oldValue)}}return newValue}else{collectSubscribers($events[name]);return accessor.svmodel||oldValue}}};if(valueType==="object"&&isFunction(val.get)&&Object.keys(val).length<=2){accessor.set=val.set;accessor.get=val.get;accessor.type=0;initCallbacks.push(function(){var data={evaluator:function(){data.type=new Date-0;
    data.element=null;$model[name]=accessor.get.call($vmodel)},element:head,type:new Date-0,handler:noop,args:[]};Registry[expose]=data;accessor.call($vmodel);delete Registry[expose]})}else{if(rcomplexType.test(valueType)){accessor.type=2;accessor.valueType=valueType;initCallbacks.push(function(){var svmodel=modelFactory(val,0,$model[name]);accessor.svmodel=svmodel;svmodel.$events[subscribers]=$events[name]})}else{accessor.type=1}}accessor._name=name;watchedProperties[name]=accessor})(i,source[i])}$$skipArray.forEach(function(name){delete source[name];delete $model[name]});$vmodel=defineProperties($vmodel,descriptorFactory(watchedProperties),source);for(var name in source){if(!watchedProperties[name]){$vmodel[name]=source[name]}}$vmodel.$id=generateID();$vmodel.$model=$model;$vmodel.$events=$events;for(var i in EventBus){var fn=EventBus[i];if(!W3C){fn=fn.bind($vmodel)}$vmodel[i]=fn}if(canHideOwn){Object.defineProperty($vmodel,"hasOwnProperty",{value:function(name){return name in this.$model},writable:false,enumerable:false,configurable:true})}else{$vmodel.hasOwnProperty=function(name){return name in $vmodel.$model}}initCallbacks.forEach(function(cb){cb()});return $vmodel}var isEqual=Object.is||function(v1,v2){if(v1===0&&v2===0){return 1/v1===1/v2}else{if(v1!==v1){return v2!==v2}else{return v1===v2}}};function safeFire(a,b,c,d){if(a.$events){EventBus.$fire.call(a,b,c,d)}}var descriptorFactory=W3C?function(obj){var descriptors={};for(var i in obj){descriptors[i]={get:obj[i],set:obj[i],enumerable:true,configurable:true}}return descriptors}:function(a){return a};function objectFactory(parent,name,value,valueType){var son=parent[name];if(valueType==="array"){if(!Array.isArray(value)||son===value){return son}son._.$unwatch();son.clear();son._.$watch();son.pushArray(value.concat());return son}else{var iterators=parent.$events[name];var pool=son.$events.$withProxyPool;if(pool){recycleProxies(pool,"with");son.$events.$withProxyPool=null}var ret=modelFactory(value);ret.$events[subscribers]=iterators;midway[ret.$id]=function(data){while(data=iterators.shift()){(function(el){avalon.nextTick(function(){if(el.type){el.rollback&&el.rollback();bindingHandlers[el.type](el,el.vmodels)}})})(data)}delete midway[ret.$id]};return ret}}if(!canHideOwn){if("__defineGetter__" in avalon){defineProperty=function(obj,prop,desc){if("value" in desc){obj[prop]=desc.value}if("get" in desc){obj.__defineGetter__(prop,desc.get)}if("set" in desc){obj.__defineSetter__(prop,desc.set)}return obj};defineProperties=function(obj,descs){for(var prop in descs){if(descs.hasOwnProperty(prop)){defineProperty(obj,prop,descs[prop])}}return obj}}if(IEVersion){window.execScript(["Function parseVB(code)","\tExecuteGlobal(code)","End Function","Dim VBClassBodies",'Set VBClassBodies=CreateObject("Scripting.Dictionary")',"Function findOrDefineVBClass(name,body)","\tDim found",'\tfound=""',"\tFor Each key in VBClassBodies","\t\tIf body=VBClassBodies.Item(key) Then","\t\t\tfound=key","\t\t\tExit For","\t\tEnd If","\tnext",'\tIf found="" Then','\t\tparseVB("Class " + name + body)',"\t\tVBClassBodies.Add name, body","\t\tfound=name","\tEnd If","\tfindOrDefineVBClass=found","End Function"].join("\n"),"VBScript");function VBMediator(instance,accessors,name,value){var accessor=accessors[name];if(arguments.length===4){accessor.call(instance,value)}else{return accessor.call(instance)}}defineProperties=function(name,accessors,properties){var className="VBClass"+setTimeout("1"),buffer=[];buffer.push("\r\n\tPrivate [__data__], [__proxy__]","\tPublic Default Function [__const__](d, p)","\t\tSet [__data__] = d: set [__proxy__] = p","\t\tSet [__const__] = Me","\tEnd Function");for(name in properties){if(!accessors.hasOwnProperty(name)){buffer.push("\tPublic ["+name+"]")}}$$skipArray.forEach(function(name){if(!accessors.hasOwnProperty(name)){buffer.push("\tPublic ["+name+"]")}});buffer.push("\tPublic ["+"hasOwnProperty"+"]");for(name in accessors){buffer.push("\tPublic Property Let ["+name+"](val"+expose+")",'\t\tCall [__proxy__](Me,[__data__], "'+name+'", val'+expose+")","\tEnd Property","\tPublic Property Set ["+name+"](val"+expose+")",'\t\tCall [__proxy__](Me,[__data__], "'+name+'", val'+expose+")","\tEnd Property","\tPublic Property Get ["+name+"]","\tOn Error Resume Next","\t\tSet["+name+'] = [__proxy__](Me,[__data__],"'+name+'")',"\tIf Err.Number <> 0 Then","\t\t["+name+'] = [__proxy__](Me,[__data__],"'+name+'")',"\tEnd If","\tOn Error Goto 0","\tEnd Property")}buffer.push("End Class");var code=buffer.join("\r\n"),realClassName=window["findOrDefineVBClass"](className,code);if(realClassName===className){window.parseVB(["Function "+className+"Factory(a, b)","\tDim o","\tSet o = (New "+className+")(a, b)","\tSet "+className+"Factory = o","End Function"].join("\r\n"))}var ret=window[realClassName+"Factory"](accessors,VBMediator);return ret}}}function Collection(model){var array=[];array.$id=generateID();array.$model=model;array.$events={};array.$events[subscribers]=[];array._=modelFactory({length:model.length});
    array._.$watch("length",function(a,b){array.$fire("length",a,b)});for(var i in EventBus){array[i]=EventBus[i]}avalon.mix(array,CollectionPrototype);return array}function mutateArray(method,pos,n,index,method2,pos2,n2){var oldLen=this.length,loop=2;while(--loop){switch(method){case"add":var array=this.$model.slice(pos,pos+n).map(function(el){if(rcomplexType.test(avalon.type(el))){return el.$id?el:modelFactory(el,0,el)}else{return el}});_splice.apply(this,[pos,0].concat(array));this._fire("add",pos,n);break;case"del":var ret=this._splice(pos,n);this._fire("del",pos,n);break}if(method2){method=method2;pos=pos2;n=n2;loop=2;method2=0}}this._fire("index",index);if(this.length!==oldLen){this._.length=this.length}return ret}var _splice=ap.splice;var CollectionPrototype={_splice:_splice,_fire:function(method,a,b){notifySubscribers(this.$events[subscribers],method,a,b)},size:function(){return this._.length},pushArray:function(array){var m=array.length,n=this.length;if(m){ap.push.apply(this.$model,array);mutateArray.call(this,"add",n,m,n)}return m+n},push:function(){var array=[];var i,n=arguments.length;for(i=0;i<n;i++){array[i]=arguments[i]}return this.pushArray(arguments)},unshift:function(){var m=arguments.length,n=this.length;if(m){ap.unshift.apply(this.$model,arguments);mutateArray.call(this,"add",0,m,0)}return m+n},shift:function(){if(this.length){var el=this.$model.shift();mutateArray.call(this,"del",0,1,0);return el}},pop:function(){var m=this.length;if(m){var el=this.$model.pop();mutateArray.call(this,"del",m-1,1,Math.max(0,m-2));return el}},splice:function(start){var m=arguments.length,args=[],change;var removed=_splice.apply(this.$model,arguments);if(removed.length){args.push("del",start,removed.length,0);change=true}if(m>2){if(change){args.splice(3,1,0,"add",start,m-2)}else{args.push("add",start,m-2,0)}change=true}if(change){return mutateArray.apply(this,args)}else{return[]}},contains:function(el){return this.indexOf(el)!==-1},remove:function(el){return this.removeAt(this.indexOf(el))},removeAt:function(index){if(index>=0){this.$model.splice(index,1);return mutateArray.call(this,"del",index,1,0)}return[]},clear:function(){this.$model.length=this.length=this._.length=0;this._fire("clear",0);return this},removeAll:function(all){if(Array.isArray(all)){all.forEach(function(el){this.remove(el)},this)}else{if(typeof all==="function"){for(var i=this.length-1;i>=0;i--){var el=this[i];if(all(el,i)){this.removeAt(i)}}}else{this.clear()}}},ensure:function(el){if(!this.contains(el)){this.push(el)}return this},set:function(index,val){if(index>=0){var valueType=avalon.type(val);if(val&&val.$model){val=val.$model}var target=this[index];if(valueType==="object"){for(var i in val){if(target.hasOwnProperty(i)){target[i]=val[i]}}}else{if(valueType==="array"){target.clear().push.apply(target,val)}else{if(target!==val){this[index]=val;this.$model[index]=val;this._fire("set",index,val)}}}}return this}};function sortByIndex(array,indexes){var map={};for(var i=0,n=indexes.length;i<n;i++){map[i]=array[i];var j=indexes[i];if(j in map){array[i]=map[j];delete map[j]}else{array[i]=array[j]}}}"sort,reverse".replace(rword,function(method){CollectionPrototype[method]=function(){var newArray=this.$model;var oldArray=newArray.concat();var mask=Math.random();var indexes=[];var hasSort;ap[method].apply(newArray,arguments);for(var i=0,n=oldArray.length;i<n;i++){var neo=newArray[i];var old=oldArray[i];if(isEqual(neo,old)){indexes.push(i)}else{var index=oldArray.indexOf(neo);indexes.push(index);oldArray[index]=mask;hasSort=true}}if(hasSort){sortByIndex(this,indexes);this._fire("move",indexes);this._fire("index",0)}return this}});var ronduplex=/^(duplex|on)$/;function registerSubscriber(data){Registry[expose]=data;avalon.openComputedCollect=true;var fn=data.evaluator;if(fn){try{var c=ronduplex.test(data.type)?data:fn.apply(0,data.args);data.handler(c,data.element,data)}catch(e){delete data.evaluator;var node=data.element;if(node.nodeType===3){var parent=node.parentNode;if(kernel.commentInterpolate){parent.replaceChild(DOC.createComment(data.value),node)}else{node.data=openTag+data.value+closeTag}}}}avalon.openComputedCollect=false;delete Registry[expose]}function collectSubscribers(list){var data=Registry[expose];if(list&&data&&avalon.Array.ensure(list,data)&&data.element){addSubscribers(data,list)}}function addSubscribers(data,list){data.$uuid=data.$uuid||generateID();list.$uuid=list.$uuid||generateID();var obj={data:data,list:list,$$uuid:data.$uuid+list.$uuid};if(!$$subscribers[obj.$$uuid]){$$subscribers[obj.$$uuid]=1;$$subscribers.push(obj)}}function disposeData(data){data.element=null;data.rollback&&data.rollback();for(var key in data){data[key]=null}}function isRemove(el){try{if(!el.parentNode){return true}}catch(e){return true}return el.msRetain?0:(el.nodeType===1?typeof el.sourceIndex==="number"?el.sourceIndex===0:!root.contains(el):!avalon.contains(root,el))}var $$subscribers=avalon.$$subscribers=[];var beginTime=new Date();var oldInfo={};
    function removeSubscribers(){var i=$$subscribers.length;var n=i;var k=0;var obj;var types=[];var newInfo={};var needTest={};while(obj=$$subscribers[--i]){var data=obj.data;var type=data.type;if(newInfo[type]){newInfo[type]++}else{newInfo[type]=1;types.push(type)}}var diff=false;types.forEach(function(type){if(oldInfo[type]!==newInfo[type]){needTest[type]=1;diff=true}});i=n;if(diff){while(obj=$$subscribers[--i]){var data=obj.data;if(data.element===void 0){continue}if(needTest[data.type]&&isRemove(data.element)){k++;$$subscribers.splice(i,1);delete $$subscribers[obj.$$uuid];avalon.Array.remove(obj.list,data);disposeData(data);obj.data=obj.list=null}}}oldInfo=newInfo;beginTime=new Date()}function notifySubscribers(list){if(list&&list.length){if(new Date()-beginTime>444&&typeof list[0]==="object"){removeSubscribers()}var args=aslice.call(arguments,1);for(var i=list.length,fn;fn=list[--i];){var el=fn.element;if(el&&el.parentNode){if(fn.$repeat){fn.handler.apply(fn,args)}else{if(fn.type!=="on"){var fun=fn.evaluator||noop;fn.handler(fun.apply(0,fn.args||[]),el,fn)}}}}}}var tagHooks={area:[1,"<map>"],param:[1,"<object>"],col:[2,"<table><tbody></tbody><colgroup>","</table>"],legend:[1,"<fieldset>"],option:[1,"<select multiple='multiple'>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],th:[3,"<table><tbody><tr>","</tr></tbody></table>"],td:[3,"<table><tbody><tr>"],g:[1,'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1">',"</svg>"],_default:W3C?[0,""]:[1,"X<div>"]};tagHooks.optgroup=tagHooks.option;tagHooks.tbody=tagHooks.tfoot=tagHooks.colgroup=tagHooks.caption=tagHooks.thead;String("circle,defs,ellipse,image,line,path,polygon,polyline,rect,symbol,text,use").replace(rword,function(tag){tagHooks[tag]=tagHooks.g});var rtagName=/<([\w:]+)/;var rxhtml=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig;var rcreate=W3C?/[^\d\D]/:/(<(?:script|link|style|meta|noscript))/ig;var scriptTypes=oneObject(["","text/javascript","text/ecmascript","application/ecmascript","application/javascript"]);var rnest=/<(?:tb|td|tf|th|tr|col|opt|leg|cap|area)/;var script=DOC.createElement("script");avalon.parseHTML=function(html){if(typeof html!=="string"){return DOC.createDocumentFragment()}html=html.replace(rxhtml,"<$1></$2>").trim();var tag=(rtagName.exec(html)||["",""])[1].toLowerCase(),wrap=tagHooks[tag]||tagHooks._default,fragment=hyperspace.cloneNode(false),wrapper=cinerator,firstChild,neo;if(!W3C){html=html.replace(rcreate,"<br class=msNoScope>$1")}wrapper.innerHTML=wrap[1]+html+(wrap[2]||"");var els=wrapper.getElementsByTagName("script");if(els.length){for(var i=0,el;el=els[i++];){if(scriptTypes[el.type]){neo=script.cloneNode(false);ap.forEach.call(el.attributes,function(attr){if(attr&&attr.specified){neo[attr.name]=attr.value;neo.setAttribute(attr.name,attr.value)}});neo.text=el.text;el.parentNode.replaceChild(neo,el)}}}for(i=wrap[0];i--;wrapper=wrapper.lastChild){}if(!W3C){var els=wrapper.getElementsByTagName("br"),n=els.length;while(el=els[--n]){if(el.className==="msNoScope"){el.parentNode.removeChild(el)}}for(els=wrapper.all,i=0;el=els[i++];){if(isVML(el)){fixVML(el)}}}while(firstChild=wrapper.firstChild){fragment.appendChild(firstChild)}return fragment};function isVML(src){var nodeName=src.nodeName;return nodeName.toLowerCase()===nodeName&&src.scopeName&&src.outerText===""}function fixVML(node){if(node.currentStyle.behavior!=="url(#default#VML)"){node.style.behavior="url(#default#VML)";node.style.display="inline-block";node.style.zoom=1}}avalon.innerHTML=function(node,html){if(!W3C&&(!rcreate.test(html)&&!rnest.test(html))){try{node.innerHTML=html;return}catch(e){}}var a=this.parseHTML(html);this.clearHTML(node).appendChild(a)};avalon.clearHTML=function(node){node.textContent="";while(node.firstChild){node.removeChild(node.firstChild)}return node};avalon.scan=function(elem,vmodel,group){elem=elem||root;var vmodels=vmodel?[].concat(vmodel):[];scanTag(elem,vmodels)};var stopScan=oneObject("area,base,basefont,br,col,command,embed,hr,img,input,link,meta,param,source,track,wbr,noscript,script,style,textarea".toUpperCase());function checkScan(elem,callback,innerHTML){var id=setTimeout(function(){var currHTML=elem.innerHTML;clearTimeout(id);if(currHTML===innerHTML){callback()}else{checkScan(elem,callback,currHTML)}})}function createSignalTower(elem,vmodel){var id=elem.getAttribute("avalonctrl")||vmodel.$id;elem.setAttribute("avalonctrl",id);vmodel.$events.expr=elem.tagName+'[avalonctrl="'+id+'"]'}var getBindingCallback=function(elem,name,vmodels){var callback=elem.getAttribute(name);if(callback){for(var i=0,vm;vm=vmodels[i++];){if(vm.hasOwnProperty(callback)&&typeof vm[callback]==="function"){return vm[callback]}}}};function executeBindings(bindings,vmodels){for(var i=0,data;data=bindings[i++];){data.vmodels=vmodels;bindingHandlers[data.type](data,vmodels);if(data.evaluator&&data.element&&data.element.nodeType===1){data.element.removeAttribute(data.name)
    }}bindings.length=0}var mergeTextNodes=IEVersion&&window.MutationObserver?function(elem){var node=elem.firstChild,text;while(node){var aaa=node.nextSibling;if(node.nodeType===3){if(text){text.nodeValue+=node.nodeValue;elem.removeChild(node)}else{text=node}}else{text=null}node=aaa}}:0;var rmsAttr=/ms-(\w+)-?(.*)/;var priorityMap={"if":10,"repeat":90,"data":100,"widget":110,"each":1400,"with":1500,"duplex":2000,"on":3000};var events=oneObject("animationend,blur,change,input,click,dblclick,focus,keydown,keypress,keyup,mousedown,mouseenter,mouseleave,mousemove,mouseout,mouseover,mouseup,scan,scroll,submit");var obsoleteAttrs=oneObject("value,title,alt,checked,selected,disabled,readonly,enabled");function bindingSorter(a,b){return a.priority-b.priority}function scanTag(elem,vmodels,node){var a=elem.getAttribute("ms-skip");if(!elem.getAttributeNode){return log("warning "+elem.tagName+" no getAttributeNode method")}var b=elem.getAttributeNode("ms-important");var c=elem.getAttributeNode("ms-controller");if(typeof a==="string"){return}else{if(node=b||c){var newVmodel=avalon.vmodels[node.value];if(!newVmodel){return}vmodels=node===b?[newVmodel]:[newVmodel].concat(vmodels);var name=node.name;elem.removeAttribute(name);avalon(elem).removeClass(name);createSignalTower(elem,newVmodel)}}scanAttr(elem,vmodels)}function scanNodeList(parent,vmodels){var node=parent.firstChild;while(node){var nextNode=node.nextSibling;scanNode(node,node.nodeType,vmodels);node=nextNode}}function scanNodeArray(nodes,vmodels){for(var i=0,node;node=nodes[i++];){scanNode(node,node.nodeType,vmodels)}}function scanNode(node,nodeType,vmodels){if(nodeType===1){scanTag(node,vmodels)}else{if(nodeType===3&&rexpr.test(node.data)){scanText(node,vmodels)}else{if(kernel.commentInterpolate&&nodeType===8&&!rexpr.test(node.nodeValue)){scanText(node,vmodels)}}}}function scanAttr(elem,vmodels){var attributes=getAttributes?getAttributes(elem):avalon.slice(elem.attributes);var bindings=[],msData={},match;for(var i=0,attr;attr=attributes[i++];){if(attr.specified){if(match=attr.name.match(rmsAttr)){var type=match[1];var param=match[2]||"";var value=attr.value;var name=attr.name;msData[name]=value;if(events[type]){param=type;type="on"}else{if(obsoleteAttrs[type]){log("ms-"+type+"已经被废弃,请使用ms-attr-*代替");if(type==="enabled"){type="disabled";value="!("+value+")"}param=type;type="attr";elem.removeAttribute(name);name="ms-attr-"+param;elem.setAttribute(name,value);match=[name];msData[name]=value}}if(typeof bindingHandlers[type]==="function"){var binding={type:type,param:param,element:elem,name:match[0],value:value,priority:type in priorityMap?priorityMap[type]:type.charCodeAt(0)*10+(Number(param)||0)};if(type==="html"||type==="text"){var token=getToken(value);avalon.mix(binding,token);binding.filters=binding.filters.replace(rhasHtml,function(){binding.type="html";binding.group=1;return""})}if(name==="ms-if-loop"){binding.priority+=100}if(vmodels.length){bindings.push(binding);if(type==="widget"){elem.msData=elem.msData||msData}}}}}}bindings.sort(bindingSorter);if(msData["ms-attr-checked"]&&msData["ms-duplex"]){log("warning!一个元素上不能同时定义ms-attr-checked与ms-duplex")}var scanNode=true;for(var i=0,binding;binding=bindings[i];i++){var type=binding.type;if(rnoscanAttrBinding.test(type)){return executeBindings(bindings.slice(0,i+1),vmodels)}else{if(scanNode){scanNode=!rnoscanNodeBinding.test(type)}}}executeBindings(bindings,vmodels);if(scanNode&&!stopScan[elem.tagName]&&rbind.test(elem.innerHTML.replace(rlt,"<").replace(rgt,">"))){mergeTextNodes&&mergeTextNodes(elem);scanNodeList(elem,vmodels)}}var rnoscanAttrBinding=/^if|widget|repeat$/;var rnoscanNodeBinding=/^each|with|html|include$/;if(!"1"[0]){var cacheAttrs=createCache(512);var rattrs=/\s+(ms-[^=\s]+)(?:=("[^"]*"|'[^']*'|[^\s>]+))?/g,rquote=/^['"]/,rtag=/<\w+\b(?:(["'])[^"]*?(\1)|[^>])*>/i,ramp=/&amp;/g;var getAttributes=function(elem){var html=elem.outerHTML;if(html.slice(0,2)==="</"||!html.trim()){return[]}var str=html.match(rtag)[0];var attributes=[],match,k,v;if(cacheAttrs[str]){return cacheAttrs[str]}while(k=rattrs.exec(str)){v=k[2];if(v){v=(rquote.test(v)?v.slice(1,-1):v).replace(ramp,"&")}var name=k[1].toLowerCase();match=name.match(rmsAttr);var binding={name:name,specified:true,value:v||""};attributes.push(binding)}return cacheAttrs(str,attributes)}}var rhasHtml=/\|\s*html\s*/,r11a=/\|\|/g,rlt=/&lt;/g,rgt=/&gt;/g;function getToken(value){if(value.indexOf("|")>0){var index=value.replace(r11a,"\u1122\u3344").indexOf("|");if(index>-1){return{filters:value.slice(index),value:value.slice(0,index),expr:true}}}return{value:value,filters:"",expr:true}}function scanExpr(str){var tokens=[],value,start=0,stop;do{stop=str.indexOf(openTag,start);if(stop===-1){break}value=str.slice(start,stop);if(value){tokens.push({value:value,filters:"",expr:false})}start=stop+openTag.length;stop=str.indexOf(closeTag,start);if(stop===-1){break}value=str.slice(start,stop);if(value){tokens.push(getToken(value))}start=stop+closeTag.length}while(1);value=str.slice(start);
        if(value){tokens.push({value:value,expr:false,filters:""})}return tokens}function scanText(textNode,vmodels){var bindings=[];if(textNode.nodeType===8){var token=getToken(textNode.nodeValue);var tokens=[token]}else{tokens=scanExpr(textNode.data)}if(tokens.length){for(var i=0,token;token=tokens[i++];){var node=DOC.createTextNode(token.value);if(token.expr){token.type="text";token.element=node;token.filters=token.filters.replace(rhasHtml,function(){token.type="html";token.group=1;return""});bindings.push(token)}hyperspace.appendChild(node)}textNode.parentNode.replaceChild(hyperspace,textNode);if(bindings.length){executeBindings(bindings,vmodels)}}}function hyphen(target){return target.replace(/([a-z\d])([A-Z]+)/g,"$1-$2").toLowerCase()}function camelize(target){if(target.indexOf("-")<0&&target.indexOf("_")<0){return target}return target.replace(/[-_][^-_]/g,function(match){return match.charAt(1).toUpperCase()})}var ClassListMethods={_toString:function(){var node=this.node;var cls=node.className;var str=typeof cls==="string"?cls:cls.baseVal;return str.split(/\s+/).join(" ")},_contains:function(cls){return(" "+this+" ").indexOf(" "+cls+" ")>-1},_add:function(cls){if(!this.contains(cls)){this._set(this+" "+cls)}},_remove:function(cls){this._set((" "+this+" ").replace(" "+cls+" "," "))},__set:function(cls){cls=cls.trim();var node=this.node;if(rsvg.test(node)){node.setAttribute("class",cls)}else{node.className=cls}}};function ClassList(node){if(!("classList" in node)){node.classList={node:node};for(var k in ClassListMethods){node.classList[k.slice(1)]=ClassListMethods[k]}}return node.classList}"add,remove".replace(rword,function(method){avalon.fn[method+"Class"]=function(cls){var el=this[0];if(cls&&typeof cls==="string"&&el&&el.nodeType===1){cls.replace(/\S+/g,function(c){ClassList(el)[method](c)})}return this}});avalon.fn.mix({hasClass:function(cls){var el=this[0]||{};return el.nodeType===1&&ClassList(el).contains(cls)},toggleClass:function(value,stateVal){var className,i=0;var classNames=value.split(/\s+/);var isBool=typeof stateVal==="boolean";while((className=classNames[i++])){var state=isBool?stateVal:!this.hasClass(className);this[state?"addClass":"removeClass"](className)}return this},attr:function(name,value){if(arguments.length===2){this[0].setAttribute(name,value);return this}else{return this[0].getAttribute(name)}},data:function(name,value){name="data-"+hyphen(name||"");switch(arguments.length){case 2:this.attr(name,value);return this;case 1:var val=this.attr(name);return parseData(val);case 0:var ret={};ap.forEach.call(this[0].attributes,function(attr){if(attr){name=attr.name;if(!name.indexOf("data-")){name=camelize(name.slice(5));ret[name]=parseData(attr.value)}}});return ret}},removeData:function(name){name="data-"+hyphen(name);this[0].removeAttribute(name);return this},css:function(name,value){if(avalon.isPlainObject(name)){for(var i in name){avalon.css(this,i,name[i])}}else{var ret=avalon.css(this,name,value)}return ret!==void 0?ret:this},position:function(){var offsetParent,offset,elem=this[0],parentOffset={top:0,left:0};if(!elem){return}if(this.css("position")==="fixed"){offset=elem.getBoundingClientRect()}else{offsetParent=this.offsetParent();offset=this.offset();if(offsetParent[0].tagName!=="HTML"){parentOffset=offsetParent.offset()}parentOffset.top+=avalon.css(offsetParent[0],"borderTopWidth",true);parentOffset.left+=avalon.css(offsetParent[0],"borderLeftWidth",true)}return{top:offset.top-parentOffset.top-avalon.css(elem,"marginTop",true),left:offset.left-parentOffset.left-avalon.css(elem,"marginLeft",true)}},offsetParent:function(){var offsetParent=this[0].offsetParent;while(offsetParent&&avalon.css(offsetParent,"position")==="static"){offsetParent=offsetParent.offsetParent}return avalon(offsetParent)},bind:function(type,fn,phase){if(this[0]){return avalon.bind(this[0],type,fn,phase)}},unbind:function(type,fn,phase){if(this[0]){avalon.unbind(this[0],type,fn,phase)}return this},val:function(value){var node=this[0];if(node&&node.nodeType===1){var get=arguments.length===0;var access=get?":get":":set";var fn=valHooks[getValType(node)+access];if(fn){var val=fn(node,value)}else{if(get){return(node.value||"").replace(/\r/g,"")}else{node.value=value}}}return get?val:this}});function parseData(data){try{if(typeof data==="object"){return data}data=data==="true"?true:data==="false"?false:data==="null"?null:+data+""===data?+data:rbrace.test(data)?avalon.parseJSON(data):data}catch(e){}return data}var rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,rvalidchars=/^[\],:{}\s]*$/,rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g,rvalidescape=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,rvalidtokens=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g;avalon.parseJSON=window.JSON?JSON.parse:function(data){if(typeof data==="string"){data=data.trim();if(data){if(rvalidchars.test(data.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,""))){return(new Function("return "+data))()}}avalon.error("Invalid JSON: "+data)
    }return data};avalon.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){avalon.fn[method]=function(val){var node=this[0]||{},win=getWindow(node),top=method==="scrollTop";if(!arguments.length){return win?(prop in win)?win[prop]:root[method]:node[method]}else{if(win){win.scrollTo(!top?val:avalon(win).scrollLeft(),top?val:avalon(win).scrollTop())}else{node[method]=val}}}});function getWindow(node){return node.window&&node.document?node:node.nodeType===9?node.defaultView||node.parentWindow:false}var cssHooks=avalon.cssHooks={};var prefixes=["","-webkit-","-o-","-moz-","-ms-"];var cssMap={"float":W3C?"cssFloat":"styleFloat"};avalon.cssNumber=oneObject("columnCount,order,fillOpacity,fontWeight,lineHeight,opacity,orphans,widows,zIndex,zoom");avalon.cssName=function(name,host,camelCase){if(cssMap[name]){return cssMap[name]}host=host||root.style;for(var i=0,n=prefixes.length;i<n;i++){camelCase=camelize(prefixes[i]+name);if(camelCase in host){return(cssMap[name]=camelCase)}}return null};cssHooks["@:set"]=function(node,name,value){try{node.style[name]=value}catch(e){}};if(window.getComputedStyle){cssHooks["@:get"]=function(node,name){if(!node||!node.style){throw new Error("getComputedStyle要求传入一个节点 "+node)}var ret,styles=getComputedStyle(node,null);if(styles){ret=name==="filter"?styles.getPropertyValue(name):styles[name];if(ret===""){ret=node.style[name]}}return ret};cssHooks["opacity:get"]=function(node){var ret=cssHooks["@:get"](node,"opacity");return ret===""?"1":ret}}else{var rnumnonpx=/^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i;var rposition=/^(top|right|bottom|left)$/;var ralpha=/alpha\([^)]*\)/i;var ie8=!!window.XDomainRequest;var salpha="DXImageTransform.Microsoft.Alpha";var border={thin:ie8?"1px":"2px",medium:ie8?"3px":"4px",thick:ie8?"5px":"6px"};cssHooks["@:get"]=function(node,name){var currentStyle=node.currentStyle;var ret=currentStyle[name];if((rnumnonpx.test(ret)&&!rposition.test(ret))){var style=node.style,left=style.left,rsLeft=node.runtimeStyle.left;node.runtimeStyle.left=currentStyle.left;style.left=name==="fontSize"?"1em":(ret||0);ret=style.pixelLeft+"px";style.left=left;node.runtimeStyle.left=rsLeft}if(ret==="medium"){name=name.replace("Width","Style");if(currentStyle[name]==="none"){ret="0px"}}return ret===""?"auto":border[ret]||ret};cssHooks["opacity:set"]=function(node,name,value){var style=node.style;var opacity=isFinite(value)&&value<=1?"alpha(opacity="+value*100+")":"";var filter=style.filter||"";style.zoom=1;style.filter=(ralpha.test(filter)?filter.replace(ralpha,opacity):filter+" "+opacity).trim();if(!style.filter){style.removeAttribute("filter")}};cssHooks["opacity:get"]=function(node){var alpha=node.filters.alpha||node.filters[salpha],op=alpha&&alpha.enabled?alpha.opacity:100;return(op/100)+""}}"top,left".replace(rword,function(name){cssHooks[name+":get"]=function(node){var computed=cssHooks["@:get"](node,name);return/px$/.test(computed)?computed:avalon(node).position()[name]+"px"}});var cssShow={position:"absolute",visibility:"hidden",display:"block"};var rdisplayswap=/^(none|table(?!-c[ea]).+)/;function showHidden(node,array){if(node.offsetWidth<=0){if(rdisplayswap.test(cssHooks["@:get"](node,"display"))){var obj={node:node};for(var name in cssShow){obj[name]=node.style[name];node.style[name]=cssShow[name]}array.push(obj)}var parent=node.parentNode;if(parent&&parent.nodeType===1){showHidden(parent,array)}}}"Width,Height".replace(rword,function(name){var method=name.toLowerCase(),clientProp="client"+name,scrollProp="scroll"+name,offsetProp="offset"+name;cssHooks[method+":get"]=function(node,which,override){var boxSizing=-4;if(typeof override==="number"){boxSizing=override}which=name==="Width"?["Left","Right"]:["Top","Bottom"];var ret=node[offsetProp];if(boxSizing===2){return ret+avalon.css(node,"margin"+which[0],true)+avalon.css(node,"margin"+which[1],true)}if(boxSizing<0){ret=ret-avalon.css(node,"border"+which[0]+"Width",true)-avalon.css(node,"border"+which[1]+"Width",true)}if(boxSizing===-4){ret=ret-avalon.css(node,"padding"+which[0],true)-avalon.css(node,"padding"+which[1],true)}return ret};cssHooks[method+"&get"]=function(node){var hidden=[];showHidden(node,hidden);var val=cssHooks[method+":get"](node);for(var i=0,obj;obj=hidden[i++];){node=obj.node;for(var n in obj){if(typeof obj[n]==="string"){node.style[n]=obj[n]}}}return val};avalon.fn[method]=function(value){var node=this[0];if(arguments.length===0){if(node.setTimeout){return node["inner"+name]||node.document.documentElement[clientProp]}if(node.nodeType===9){var doc=node.documentElement;return Math.max(node.body[scrollProp],doc[scrollProp],node.body[offsetProp],doc[offsetProp],doc[clientProp])}return cssHooks[method+"&get"](node)}else{return this.css(method,value)}};avalon.fn["inner"+name]=function(){return cssHooks[method+":get"](this[0],void 0,-2)};avalon.fn["outer"+name]=function(includeMargin){return cssHooks[method+":get"](this[0],void 0,includeMargin===true?2:0)}});avalon.fn.offset=function(){var node=this[0],box={left:0,top:0};
        if(!node||!node.tagName||!node.ownerDocument){return box}var doc=node.ownerDocument,body=doc.body,root=doc.documentElement,win=doc.defaultView||doc.parentWindow;if(!avalon.contains(root,node)){return box}if(node.getBoundingClientRect){box=node.getBoundingClientRect()}var clientTop=root.clientTop||body.clientTop,clientLeft=root.clientLeft||body.clientLeft,scrollTop=Math.max(win.pageYOffset||0,root.scrollTop,body.scrollTop),scrollLeft=Math.max(win.pageXOffset||0,root.scrollLeft,body.scrollLeft);return{top:box.top+scrollTop-clientTop,left:box.left+scrollLeft-clientLeft}};function getValType(el){var ret=el.tagName.toLowerCase();return ret==="input"&&/checkbox|radio/.test(el.type)?"checked":ret}var roption=/^<option(?:\s+\w+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s>]+))?)*\s+value[\s=]/i;var valHooks={"option:get":IEVersion?function(node){return roption.test(node.outerHTML)?node.value:node.text.trim()}:function(node){return node.value},"select:get":function(node,value){var option,options=node.options,index=node.selectedIndex,getter=valHooks["option:get"],one=node.type==="select-one"||index<0,values=one?null:[],max=one?index+1:options.length,i=index<0?max:one?index:0;for(;i<max;i++){option=options[i];if((option.selected||i===index)&&!option.disabled){value=getter(option);if(one){return value}values.push(value)}}return values},"select:set":function(node,values,optionSet){values=[].concat(values);var getter=valHooks["option:get"];for(var i=0,el;el=node.options[i++];){if((el.selected=values.indexOf(getter(el))>-1)){optionSet=true}}if(!optionSet){node.selectedIndex=-1}}};var meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};var quote=window.JSON&&JSON.stringify||function(str){return'"'+str.replace(/[\\\"\x00-\x1f]/g,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"'};var keywords="break,case,catch,continue,debugger,default,delete,do,else,false"+",finally,for,function,if,in,instanceof,new,null,return,switch,this"+",throw,true,try,typeof,var,void,while,with"+",abstract,boolean,byte,char,class,const,double,enum,export,extends"+",final,float,goto,implements,import,int,interface,long,native"+",package,private,protected,public,short,static,super,synchronized"+",throws,transient,volatile"+",arguments,let,yield"+",undefined";var rrexpstr=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|[\s\t\n]*\.[\s\t\n]*[$\w\.]+/g;var rsplit=/[^\w$]+/g;var rkeywords=new RegExp(["\\b"+keywords.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g");var rnumber=/\b\d[^,]*/g;var rcomma=/^,+|,+$/g;var cacheVars=createCache(512);var getVariables=function(code){var key=","+code.trim();if(cacheVars[key]){return cacheVars[key]}var match=code.replace(rrexpstr,"").replace(rsplit,",").replace(rkeywords,"").replace(rnumber,"").replace(rcomma,"").split(/^$|,+/);return cacheVars(key,uniqSet(match))};function addAssign(vars,scope,name,data){var ret=[],prefix=" = "+name+".";for(var i=vars.length,prop;prop=vars[--i];){if(scope.hasOwnProperty(prop)){ret.push(prop+prefix+prop);data.vars.push(prop);if(data.type==="duplex"){vars.get=name+"."+prop}vars.splice(i,1)}}return ret}function uniqSet(array){var ret=[],unique={};for(var i=0;i<array.length;i++){var el=array[i];var id=el&&typeof el.$id==="string"?el.$id:el;if(!unique[id]){unique[id]=ret.push(el)}}return ret}var cacheExprs=createCache(128);var rduplex=/\w\[.*\]|\w\.\w/;var rproxy=/(\$proxy\$[a-z]+)\d+$/;var rthimRightParentheses=/\)\s*$/;var rthimOtherParentheses=/\)\s*\|/g;var rquoteFilterName=/\|\s*([$\w]+)/g;var rpatchBracket=/"\s*\["/g;var rthimLeftParentheses=/"\s*\(/g;function parseFilter(val,filters){filters=filters.replace(rthimRightParentheses,"").replace(rthimOtherParentheses,function(){return"],|"}).replace(rquoteFilterName,function(a,b){return"["+quote(b)}).replace(rpatchBracket,function(){return'"],["'}).replace(rthimLeftParentheses,function(){return'",'})+"]";return"return avalon.filters.$filter("+val+", "+filters+")"}function parseExpr(code,scopes,data){var dataType=data.type;var filters=data.filters||"";var exprId=scopes.map(function(el){return String(el.$id).replace(rproxy,"$1")})+code+dataType+filters;var vars=getVariables(code).concat(),assigns=[],names=[],args=[],prefix="";scopes=uniqSet(scopes);data.vars=[];for(var i=0,sn=scopes.length;i<sn;i++){if(vars.length){var name="vm"+expose+"_"+i;names.push(name);args.push(scopes[i]);assigns.push.apply(assigns,addAssign(vars,scopes[i],name,data))}}if(!assigns.length&&dataType==="duplex"){return}if(dataType!=="duplex"&&(code.indexOf("||")>-1||code.indexOf("&&")>-1)){data.vars.forEach(function(v){var reg=new RegExp("\\b"+v+"(?:\\.\\w+|\\[\\w+\\])+","ig");code=code.replace(reg,function(_){var c=_.charAt(v.length);var r=IEVersion?code.slice(arguments[1]+_.length):RegExp.rightContext;var method=/^\s*\(/.test(r);if(c==="."||c==="["||method){var name="var"+String(Math.random()).replace(/^0\./,"");if(method){var array=_.split(".");if(array.length>2){var last=array.pop();
        assigns.push(name+" = "+array.join("."));return name+"."+last}else{return _}}assigns.push(name+" = "+_);return name}else{return _}})})}data.args=args;var fn=cacheExprs[exprId];if(fn){data.evaluator=fn;return}var prefix=assigns.join(", ");if(prefix){prefix="var "+prefix}if(/\S/.test(filters)){if(!/text|html/.test(data.type)){throw Error("ms-"+data.type+"不支持过滤器")}code="\nvar ret"+expose+" = "+code+";\r\n";code+=parseFilter("ret"+expose,filters)}else{if(dataType==="duplex"){var _body="'use strict';\nreturn function(vvv){\n\t"+prefix+";\n\tif(!arguments.length){\n\t\treturn "+code+"\n\t}\n\t"+(!rduplex.test(code)?vars.get:code)+"= vvv;\n} ";try{fn=Function.apply(noop,names.concat(_body));data.evaluator=cacheExprs(exprId,fn)}catch(e){log("debug: parse error,"+e.message)}return}else{if(dataType==="on"){if(code.indexOf("(")===-1){code+=".call(this, $event)"}else{code=code.replace("(",".call(this,")}names.push("$event");code="\nreturn "+code+";";var lastIndex=code.lastIndexOf("\nreturn");var header=code.slice(0,lastIndex);var footer=code.slice(lastIndex);code=header+"\n"+footer}else{code="\nreturn "+code+";"}}}try{fn=Function.apply(noop,names.concat("'use strict';\n"+prefix+code));data.evaluator=cacheExprs(exprId,fn)}catch(e){log("debug: parse error,"+e.message)}finally{vars=textBuffer=names=null}}function parseExprProxy(code,scopes,data,tokens,noregister){if(Array.isArray(tokens)){code=tokens.map(function(el){return el.expr?"("+el.value+")":quote(el.value)}).join(" + ")}parseExpr(code,scopes,data);if(data.evaluator&&!noregister){data.handler=bindingExecutors[data.handlerName||data.type];registerSubscriber(data)}}avalon.parseExprProxy=parseExprProxy;var bools="autofocus,autoplay,async,allowTransparency,checked,controls,declare,disabled,defer,defaultChecked,defaultSelected"+"contentEditable,isMap,loop,multiple,noHref,noResize,noShade,open,readOnly,selected";var boolMap={};bools.replace(rword,function(name){boolMap[name.toLowerCase()]=name});var propMap={"accept-charset":"acceptCharset","char":"ch","charoff":"chOff","class":"className","for":"htmlFor","http-equiv":"httpEquiv"};var anomaly="accessKey,bgColor,cellPadding,cellSpacing,codeBase,codeType,colSpan,"+"dateTime,defaultValue,frameBorder,longDesc,maxLength,marginWidth,marginHeight,"+"rowSpan,tabIndex,useMap,vSpace,valueType,vAlign";anomaly.replace(rword,function(name){propMap[name.toLowerCase()]=name});var rnoscripts=/<noscript.*?>(?:[\s\S]+?)<\/noscript>/img;var rnoscriptText=/<noscript.*?>([\s\S]+?)<\/noscript>/im;var getXHR=function(){return new (window.XMLHttpRequest||ActiveXObject)("Microsoft.XMLHTTP")};var cacheTmpls=avalon.templateCache={};bindingHandlers.attr=function(data,vmodels){var text=data.value.trim(),simple=true;if(text.indexOf(openTag)>-1&&text.indexOf(closeTag)>2){simple=false;if(rexpr.test(text)&&RegExp.rightContext===""&&RegExp.leftContext===""){simple=true;text=RegExp.$1}}if(data.type==="include"){var elem=data.element;data.includeRendered=getBindingCallback(elem,"data-include-rendered",vmodels);data.includeLoaded=getBindingCallback(elem,"data-include-loaded",vmodels);var outer=data.includeReplaced=!!avalon(elem).data("includeReplace");data.startInclude=DOC.createComment("ms-include");data.endInclude=DOC.createComment("ms-include-end");if(outer){data.element=data.startInclude;elem.parentNode.insertBefore(data.startInclude,elem);elem.parentNode.insertBefore(data.endInclude,elem.nextSibling)}else{elem.insertBefore(data.startInclude,elem.firstChild);elem.appendChild(data.endInclude)}}data.handlerName="attr";parseExprProxy(text,vmodels,data,(simple?0:scanExpr(data.value)))};bindingExecutors.attr=function(val,elem,data){var method=data.type,attrName=data.param;if(method==="css"){avalon(elem).css(attrName,val)}else{if(method==="attr"){if(boolMap[attrName]){var bool=boolMap[attrName];if(typeof elem[bool]==="boolean"){return elem[bool]=!!val}}var toRemove=(val===false)||(val===null)||(val===void 0);if(!W3C&&propMap[attrName]){attrName=propMap[attrName]}if(toRemove){return elem.removeAttribute(attrName)}var isInnate=rsvg.test(elem)?false:(DOC.namespaces&&isVML(elem))?true:attrName in elem.cloneNode(false);if(isInnate){elem[attrName]=val}else{elem.setAttribute(attrName,val)}}else{if(method==="include"&&val){var vmodels=data.vmodels;var rendered=data.includeRendered;var loaded=data.includeLoaded;var replace=data.includeReplaced;var target=replace?elem.parentNode:elem;function scanTemplate(text){if(loaded){text=loaded.apply(target,[text].concat(vmodels))}if(rendered){checkScan(target,function(){rendered.call(target)},NaN)}while(true){var node=data.startInclude.nextSibling;if(node&&node!==data.endInclude){target.removeChild(node)}else{break}}var dom=avalon.parseHTML(text);var nodes=avalon.slice(dom.childNodes);target.insertBefore(dom,data.endInclude);scanNodeArray(nodes,vmodels)}if(data.param==="src"){if(cacheTmpls[val]){avalon.nextTick(function(){scanTemplate(cacheTmpls[val])})}else{var xhr=getXHR();xhr.onreadystatechange=function(){if(xhr.readyState===4){var s=xhr.status;
        if(s>=200&&s<300||s===304||s===1223){scanTemplate(cacheTmpls[val]=xhr.responseText)}}};xhr.open("GET",val,true);if("withCredentials" in xhr){xhr.withCredentials=true}xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");xhr.send(null)}}else{var el=val&&val.nodeType===1?val:DOC.getElementById(val);if(el){if(el.tagName==="NOSCRIPT"&&!(el.innerHTML||el.fixIE78)){var xhr=getXHR();xhr.open("GET",location,false);xhr.send(null);var noscripts=DOC.getElementsByTagName("noscript");var array=(xhr.responseText||"").match(rnoscripts)||[];var n=array.length;for(var i=0;i<n;i++){var tag=noscripts[i];if(tag){tag.style.display="none";tag.fixIE78=(array[i].match(rnoscriptText)||["","&nbsp;"])[1]}}}avalon.nextTick(function(){scanTemplate(el.fixIE78||el.value||el.innerText||el.innerHTML)})}}}else{if(!root.hasAttribute&&typeof val==="string"&&(method==="src"||method==="href")){val=val.replace(/&amp;/g,"&")}elem[method]=val;if(window.chrome&&elem.tagName==="EMBED"){var parent=elem.parentNode;var comment=document.createComment("ms-src");parent.replaceChild(comment,elem);parent.replaceChild(elem,comment)}}}}};"title,alt,src,value,css,include,href".replace(rword,function(name){bindingHandlers[name]=bindingHandlers.attr});bindingHandlers["class"]=function(data,vmodels){var oldStyle=data.param,text=data.value,rightExpr;data.handlerName="class";if(!oldStyle||isFinite(oldStyle)){data.param="";var noExpr=text.replace(rexprg,function(a){return a.replace(/./g,"0")});var colonIndex=noExpr.indexOf(":");if(colonIndex===-1){var className=text}else{className=text.slice(0,colonIndex);rightExpr=text.slice(colonIndex+1);parseExpr(rightExpr,vmodels,data);if(!data.evaluator){log("debug: ms-class '"+(rightExpr||"").trim()+"' 不存在于VM中");return false}else{data._evaluator=data.evaluator;data._args=data.args}}var hasExpr=rexpr.test(className);if(!hasExpr){data.immobileClass=className}parseExprProxy("",vmodels,data,(hasExpr?scanExpr(className):0))}else{data.immobileClass=data.oldStyle=data.param;parseExprProxy(text,vmodels,data)}};bindingExecutors["class"]=function(val,elem,data){var $elem=avalon(elem),method=data.type;if(method==="class"&&data.oldStyle){$elem.toggleClass(data.oldStyle,!!val)}else{data.toggleClass=data._evaluator?!!data._evaluator.apply(elem,data._args):true;data.newClass=data.immobileClass||val;if(data.oldClass&&data.newClass!==data.oldClass){$elem.removeClass(data.oldClass)}data.oldClass=data.newClass;switch(method){case"class":$elem.toggleClass(data.newClass,data.toggleClass);break;case"hover":case"active":if(!data.hasBindEvent){var activate="mouseenter";var abandon="mouseleave";if(method==="active"){elem.tabIndex=elem.tabIndex||-1;activate="mousedown";abandon="mouseup";var fn0=$elem.bind("mouseleave",function(){data.toggleClass&&$elem.removeClass(data.newClass)})}var fn1=$elem.bind(activate,function(){data.toggleClass&&$elem.addClass(data.newClass)});var fn2=$elem.bind(abandon,function(){data.toggleClass&&$elem.removeClass(data.newClass)});data.rollback=function(){$elem.unbind("mouseleave",fn0);$elem.unbind(activate,fn1);$elem.unbind(abandon,fn2)};data.hasBindEvent=true}break}}};"hover,active".replace(rword,function(method){bindingHandlers[method]=bindingHandlers["class"]});bindingExecutors.data=function(val,elem,data){var key="data-"+data.param;if(val&&typeof val==="object"){elem[key]=val}else{elem.setAttribute(key,String(val))}};bindingExecutors.text=function(val,elem){val=val==null?"":val;if(elem.nodeType===3){try{elem.data=val}catch(e){}}else{if("textContent" in elem){elem.textContent=val}else{elem.innerText=val}}};bindingExecutors.html=function(val,elem,data){val=val==null?"":val;var isHtmlFilter="group" in data;var parent=isHtmlFilter?elem.parentNode:elem;if(!parent){return}if(val.nodeType===11){var fragment=val}else{if(val.nodeType===1||val.item){var nodes=val.nodeType===1?val.childNodes:val.item?val:[];fragment=hyperspace.cloneNode(true);while(nodes[0]){fragment.appendChild(nodes[0])}}else{fragment=avalon.parseHTML(val)}}var comment=DOC.createComment("ms-html");if(isHtmlFilter){parent.insertBefore(comment,elem);var n=data.group,i=1;while(i<n){var node=elem.nextSibling;if(node){parent.removeChild(node);i++}}parent.removeChild(elem);data.element=comment}else{avalon.clearHTML(parent).appendChild(comment)}if(isHtmlFilter){data.group=fragment.childNodes.length||1}var nodes=avalon.slice(fragment.childNodes);if(nodes[0]){if(comment.parentNode){comment.parentNode.replaceChild(fragment,comment)}if(isHtmlFilter){data.element=nodes[0]}}scanNodeArray(nodes,data.vmodels)};bindingHandlers["if"]=bindingHandlers.data=bindingHandlers.text=bindingHandlers.html=function(data,vmodels){parseExprProxy(data.value,vmodels,data)};bindingExecutors["if"]=function(val,elem,data){if(val){if(elem.nodeType===8){elem.parentNode.replaceChild(data.template,elem);elem=data.element=data.template}if(elem.getAttribute(data.name)){elem.removeAttribute(data.name);scanAttr(elem,data.vmodels)}data.rollback=null}else{if(elem.nodeType===1){var node=data.element=DOC.createComment("ms-if");
        elem.parentNode.replaceChild(node,elem);data.template=elem;ifGroup.appendChild(elem);data.rollback=function(){if(elem.parentNode===ifGroup){ifGroup.removeChild(elem)}}}}};function parseDisplay(nodeName,val){var key="_"+nodeName;if(!parseDisplay[key]){var node=DOC.createElement(nodeName);root.appendChild(node);if(W3C){val=getComputedStyle(node,null).display}else{val=node.currentStyle.display}root.removeChild(node);parseDisplay[key]=val}return parseDisplay[key]}avalon.parseDisplay=parseDisplay;bindingHandlers.visible=function(data,vmodels){var elem=avalon(data.element);var display=elem.css("display");if(display==="none"){var style=elem[0].style;var has=/visibility/i.test(style.cssText);var visible=elem.css("visibility");style.display="";style.visibility="hidden";display=elem.css("display");if(display==="none"){display=parseDisplay(elem[0].nodeName)}style.visibility=has?visible:""}data.display=display;parseExprProxy(data.value,vmodels,data)};bindingExecutors.visible=function(val,elem,data){elem.style.display=val?data.display:"none"};var rdash=/\(([^)]*)\)/;bindingHandlers.on=function(data,vmodels){var value=data.value;data.type="on";var eventType=data.param.replace(/-\d+$/,"");if(typeof bindingHandlers.on[eventType+"Hook"]==="function"){bindingHandlers.on[eventType+"Hook"](data)}if(value.indexOf("(")>0&&value.indexOf(")")>-1){var matched=(value.match(rdash)||["",""])[1].trim();if(matched===""||matched==="$event"){value=value.replace(rdash,"")}}parseExprProxy(value,vmodels,data)};bindingExecutors.on=function(callback,elem,data){callback=function(e){var fn=data.evaluator||noop;return fn.apply(this,data.args.concat(e))};var eventType=data.param.replace(/-\d+$/,"");if(eventType==="scan"){callback.call(elem,{type:eventType})}else{if(typeof data.specialBind==="function"){data.specialBind(elem,callback)}else{var removeFn=avalon.bind(elem,eventType,callback)}}data.rollback=function(){if(typeof data.specialUnbind==="function"){data.specialUnbind()}else{avalon.unbind(elem,eventType,removeFn)}}};bindingHandlers.widget=function(data,vmodels){var args=data.value.match(rword);var elem=data.element;var widget=args[0];var id=args[1];if(!id||id==="$"){id=generateID(widget)}var optName=args[2]||widget;var constructor=avalon.ui[widget];if(typeof constructor==="function"){vmodels=elem.vmodels||vmodels;for(var i=0,v;v=vmodels[i++];){if(v.hasOwnProperty(optName)&&typeof v[optName]==="object"){var vmOptions=v[optName];vmOptions=vmOptions.$model||vmOptions;break}}if(vmOptions){var wid=vmOptions[widget+"Id"];if(typeof wid==="string"){id=wid}}var widgetData=avalon.getWidgetData(elem,widget);data.value=[widget,id,optName].join(",");data[widget+"Id"]=id;data.evaluator=noop;elem.msData["ms-widget-id"]=id;var options=data[widget+"Options"]=avalon.mix({},constructor.defaults,vmOptions||{},widgetData);elem.removeAttribute("ms-widget");var vmodel=constructor(elem,data,vmodels)||{};if(vmodel.$id){avalon.vmodels[id]=vmodel;createSignalTower(elem,vmodel);if(vmodel.hasOwnProperty("$init")){vmodel.$init(function(){avalon.scan(elem,[vmodel].concat(vmodels));if(typeof options.onInit==="function"){options.onInit.call(elem,vmodel,options,vmodels)}})}data.rollback=function(){try{vmodel.widgetElement=null;vmodel.$remove()}catch(e){}elem.msData={};delete avalon.vmodels[vmodel.$id]};addSubscribers(data,widgetList);if(window.chrome){elem.addEventListener("DOMNodeRemovedFromDocument",function(){setTimeout(removeSubscribers)})}}else{avalon.scan(elem,vmodels)}}else{if(vmodels.length){elem.vmodels=vmodels}}};var widgetList=[];var duplexBinding=bindingHandlers.duplex=function(data,vmodels){var elem=data.element,hasCast;parseExprProxy(data.value,vmodels,data,0,1);data.changed=getBindingCallback(elem,"data-duplex-changed",vmodels)||noop;if(data.evaluator&&data.args){var params=[];var casting=oneObject("string,number,boolean,checked");if(elem.type==="radio"&&data.param===""){data.param="checked"}if(elem.msData){elem.msData["ms-duplex"]=data.value}data.param.replace(/\w+/g,function(name){if(/^(checkbox|radio)$/.test(elem.type)&&/^(radio|checked)$/.test(name)){if(name==="radio"){log("ms-duplex-radio已经更名为ms-duplex-checked")}name="checked";data.isChecked=true}if(name==="bool"){name="boolean";log("ms-duplex-bool已经更名为ms-duplex-boolean")}else{if(name==="text"){name="string";log("ms-duplex-text已经更名为ms-duplex-string")}}if(casting[name]){hasCast=true}avalon.Array.ensure(params,name)});if(!hasCast){params.push("string")}data.param=params.join("-");data.bound=function(type,callback){if(elem.addEventListener){elem.addEventListener(type,callback,false)}else{elem.attachEvent("on"+type,callback)}var old=data.rollback;data.rollback=function(){elem.avalonSetter=null;avalon.unbind(elem,type,callback);old&&old()}};for(var i in avalon.vmodels){var v=avalon.vmodels[i];v.$fire("avalon-ms-duplex-init",data)}var cpipe=data.pipe||(data.pipe=pipe);cpipe(null,data,"init");var tagName=elem.tagName;duplexBinding[tagName]&&duplexBinding[tagName](elem,data.evaluator.apply(null,data.args),data)}};
    function fixNull(val){return val==null?"":val}avalon.duplexHooks={checked:{get:function(val,data){return !data.element.oldValue}},string:{get:function(val){return val},set:fixNull},"boolean":{get:function(val){return val==="true"},set:fixNull},number:{get:function(val){return isFinite(val)?parseFloat(val)||0:val},set:fixNull}};function pipe(val,data,action,e){data.param.replace(/\w+/g,function(name){var hook=avalon.duplexHooks[name];if(hook&&typeof hook[action]==="function"){val=hook[action](val,data)}});return val}var TimerID,ribbon=[];function W3CFire(el,name,detail){var event=DOC.createEvent("Events");event.initEvent(name,true,true);event.fireByAvalon=true;if(detail){event.detail=detail}el.dispatchEvent(event)}avalon.tick=function(fn){if(ribbon.push(fn)===1){TimerID=setInterval(ticker,60)}};function ticker(){for(var n=ribbon.length-1;n>=0;n--){var el=ribbon[n];if(el()===false){ribbon.splice(n,1)}}if(!ribbon.length){clearInterval(TimerID)}}var watchValueInTimer=noop;new function(){try{var setters={};var aproto=HTMLInputElement.prototype;var bproto=HTMLTextAreaElement.prototype;function newSetter(value){if(avalon.contains(root,this)){setters[this.tagName].call(this,value);if(this.avalonSetter){this.avalonSetter()}}}var inputProto=HTMLInputElement.prototype;Object.getOwnPropertyNames(inputProto);setters["INPUT"]=Object.getOwnPropertyDescriptor(aproto,"value").set;Object.defineProperty(aproto,"value",{set:newSetter});setters["TEXTAREA"]=Object.getOwnPropertyDescriptor(bproto,"value").set;Object.defineProperty(bproto,"value",{set:newSetter})}catch(e){watchValueInTimer=avalon.tick}};if(IEVersion){avalon.bind(DOC,"selectionchange",function(e){var el=DOC.activeElement;if(el&&typeof el.avalonSetter==="function"){el.avalonSetter()}})}duplexBinding.INPUT=function(element,evaluator,data){var type=element.type,bound=data.bound,$elem=avalon(element),composing=false;function callback(value){data.changed.call(this,value,data)}function compositionStart(){composing=true}function compositionEnd(){composing=false}function updateVModel(){if(composing){return}var val=element.oldValue=element.value;var lastValue=data.pipe(val,data,"get");if($elem.data("duplex-observe")!==false){evaluator(lastValue);callback.call(element,lastValue);if($elem.data("duplex-focus")){avalon.nextTick(function(){element.focus()})}}}data.handler=function(){var val=data.pipe(evaluator(),data,"set")+"";if(val!==element.oldValue){element.value=val}};if(data.isChecked||element.type==="radio"){var IE6=IEVersion===6;updateVModel=function(){if($elem.data("duplex-observe")!==false){var lastValue=data.pipe(element.value,data,"get");evaluator(lastValue);callback.call(element,lastValue)}};data.handler=function(){var val=evaluator();var checked=data.isChecked?!!val:val+""===element.value;element.oldValue=checked;if(IE6){setTimeout(function(){element.defaultChecked=checked;element.checked=checked},31)}else{element.checked=checked}};bound("click",updateVModel)}else{if(type==="checkbox"){updateVModel=function(){if($elem.data("duplex-observe")!==false){var method=element.checked?"ensure":"remove";var array=evaluator();if(!Array.isArray(array)){log("ms-duplex应用于checkbox上要对应一个数组");array=[array]}avalon.Array[method](array,data.pipe(element.value,data,"get"));callback.call(element,array)}};data.handler=function(){var array=[].concat(evaluator());element.checked=array.indexOf(data.pipe(element.value,data,"get"))>-1};bound(W3C?"change":"click",updateVModel)}else{var events=element.getAttribute("data-duplex-event")||element.getAttribute("data-event")||"input";if(element.attributes["data-event"]){log("data-event指令已经废弃，请改用data-duplex-event")}function delay(e){setTimeout(function(){updateVModel(e)})}events.replace(rword,function(name){switch(name){case"input":if(!IEVersion){bound("input",updateVModel);bound("compositionstart",compositionStart);bound("compositionend",compositionEnd);bound("DOMAutoComplete",updateVModel)}else{if(IEVersion>8){bound("input",updateVModel)}else{bound("propertychange",function(e){if(e.propertyName==="value"){updateVModel()}})}bound("dragend",delay)}break;default:bound(name,updateVModel);break}})}}if(/text|password/.test(element.type)){watchValueInTimer(function(){if(root.contains(element)){if(element.value!==element.oldValue){updateVModel()}}else{if(!element.msRetain){return false}}})}element.avalonSetter=updateVModel;element.oldValue=element.value;registerSubscriber(data);callback.call(element,element.value)};duplexBinding.TEXTAREA=duplexBinding.INPUT;duplexBinding.SELECT=function(element,evaluator,data){var $elem=avalon(element);function updateVModel(){if($elem.data("duplex-observe")!==false){var val=$elem.val();if(Array.isArray(val)){val=val.map(function(v){return data.pipe(v,data,"get")})}else{val=data.pipe(val,data,"get")}if(val+""!==element.oldValue){evaluator(val)}data.changed.call(element,val,data)}}data.handler=function(){var val=evaluator();val=val&&val.$model||val;if(Array.isArray(val)){if(!element.multiple){log("ms-duplex在<select multiple=true>上要求对应一个数组")
    }}else{if(element.multiple){log("ms-duplex在<select multiple=false>不能对应一个数组")}}val=Array.isArray(val)?val.map(String):val+"";if(val+""!==element.oldValue){$elem.val(val);element.oldValue=val+""}};data.bound("change",updateVModel);checkScan(element,function(){registerSubscriber(data);data.changed.call(element,evaluator(),data)},NaN)};bindingHandlers.repeat=function(data,vmodels){var type=data.type;parseExprProxy(data.value,vmodels,data,0,1);data.proxies=[];var freturn=false;try{var $repeat=data.$repeat=data.evaluator.apply(0,data.args||[]);var xtype=avalon.type($repeat);if(xtype!=="object"&&xtype!=="array"){freturn=true;avalon.log("warning:"+data.value+"对应类型不正确")}}catch(e){freturn=true;avalon.log("warning:"+data.value+"编译出错")}var arr=data.value.split(".")||[];if(arr.length>1){arr.pop();var n=arr[0];for(var i=0,v;v=vmodels[i++];){if(v&&v.hasOwnProperty(n)){var events=v[n].$events||{};events[subscribers]=events[subscribers]||[];events[subscribers].push(data);break}}}var elem=data.element;elem.removeAttribute(data.name);data.sortedCallback=getBindingCallback(elem,"data-with-sorted",vmodels);data.renderedCallback=getBindingCallback(elem,"data-"+type+"-rendered",vmodels);var signature=generateID(type);var comment=data.element=DOC.createComment(signature+":end");data.clone=DOC.createComment(signature);hyperspace.appendChild(comment);if(type==="each"||type==="with"){data.template=elem.innerHTML.trim();avalon.clearHTML(elem).appendChild(comment)}else{data.template=elem.outerHTML.trim();elem.parentNode.replaceChild(comment,elem)}data.template=avalon.parseHTML(data.template);data.rollback=function(){var elem=data.element;if(!elem){return}bindingExecutors.repeat.call(data,"clear");var parentNode=elem.parentNode;var content=data.template;var target=content.firstChild;parentNode.replaceChild(content,elem);var start=data.$stamp;start&&start.parentNode&&start.parentNode.removeChild(start);target=data.element=data.type==="repeat"?target:parentNode};if(freturn){return}data.handler=bindingExecutors.repeat;data.$outer={};var check0="$key";var check1="$val";if(Array.isArray($repeat)){check0="$first";check1="$last"}for(var i=0,p;p=vmodels[i++];){if(p.hasOwnProperty(check0)&&p.hasOwnProperty(check1)){data.$outer=p;break}}var $events=$repeat.$events;var $list=($events||{})[subscribers];if($list&&avalon.Array.ensure($list,data)){addSubscribers(data,$list)}if(xtype==="object"){data.$with=true;var pool=!$events?{}:$events.$withProxyPool||($events.$withProxyPool={});data.handler("append",$repeat,pool)}else{if($repeat.length){data.handler("add",0,$repeat.length)}}};bindingExecutors.repeat=function(method,pos,el){if(method){var data=this;var end=data.element;var parent=end.parentNode;var proxies=data.proxies;var transation=hyperspace.cloneNode(false);switch(method){case"add":var n=pos+el;var array=data.$repeat;var last=array.length-1;var fragments=[];var start=locateNode(data,pos);for(var i=pos;i<n;i++){var proxy=eachProxyAgent(i,data);proxies.splice(i,0,proxy);shimController(data,transation,proxy,fragments)}parent.insertBefore(transation,start);for(var i=0,fragment;fragment=fragments[i++];){scanNodeArray(fragment.nodes,fragment.vmodels);fragment.nodes=fragment.vmodels=null}break;case"del":start=proxies[pos].$stamp;end=locateNode(data,pos+el);sweepNodes(start,end);var removed=proxies.splice(pos,el);recycleProxies(removed,"each");break;case"clear":var check=data.$stamp||proxies[0];if(check){start=check.$stamp||check;sweepNodes(start,end)}recycleProxies(proxies,"each");break;case"move":start=proxies[0].$stamp;var signature=start.nodeValue;var rooms=[];var room=[],node;sweepNodes(start,end,function(){room.unshift(this);if(this.nodeValue===signature){rooms.unshift(room);room=[]}});sortByIndex(proxies,pos);sortByIndex(rooms,pos);while(room=rooms.shift()){while(node=room.shift()){transation.appendChild(node)}}parent.insertBefore(transation,end);break;case"index":var last=proxies.length-1;for(;el=proxies[pos];pos++){el.$index=pos;el.$first=pos===0;el.$last=pos===last}return;case"set":var proxy=proxies[pos];if(proxy){notifySubscribers(proxy.$events.$index)}return;case"append":var pool=el;var keys=[];var fragments=[];for(var key in pos){if(pos.hasOwnProperty(key)&&key!=="hasOwnProperty"){keys.push(key)}}if(data.sortedCallback){var keys2=data.sortedCallback.call(parent,keys);if(keys2&&Array.isArray(keys2)&&keys2.length){keys=keys2}}for(var i=0,key;key=keys[i++];){if(key!=="hasOwnProperty"){if(!pool[key]){pool[key]=withProxyAgent(key,data)}shimController(data,transation,pool[key],fragments)}}var comment=data.$stamp=data.clone;parent.insertBefore(comment,end);parent.insertBefore(transation,end);for(var i=0,fragment;fragment=fragments[i++];){scanNodeArray(fragment.nodes,fragment.vmodels);fragment.nodes=fragment.vmodels=null}break}if(method==="clear"){method="del"}var callback=data.renderedCallback||noop,args=arguments;checkScan(parent,function(){callback.apply(parent,args);if(parent.oldValue&&parent.tagName==="SELECT"){avalon(parent).val(parent.oldValue.split(","))
    }},NaN)}};"with,each".replace(rword,function(name){bindingHandlers[name]=bindingHandlers.repeat});function shimController(data,transation,proxy,fragments){var content=data.template.cloneNode(true);var nodes=avalon.slice(content.childNodes);if(proxy.$stamp){content.insertBefore(proxy.$stamp,content.firstChild)}transation.appendChild(content);var nv=[proxy].concat(data.vmodels);var fragment={nodes:nodes,vmodels:nv};fragments.push(fragment)}function locateNode(data,pos){var proxy=data.proxies[pos];return proxy?proxy.$stamp:data.element}function sweepNodes(start,end,callback){while(true){var node=end.previousSibling;if(!node){break}node.parentNode.removeChild(node);callback&&callback.call(node);if(node===start){break}}}var eachProxyPool=[];var withProxyPool=[];function eachProxyFactory(name){var source={$host:[],$outer:{},$stamp:1,$index:0,$first:false,$last:false,$remove:avalon.noop};source[name]={get:function(){return this.$host[this.$index]},set:function(val){this.$host.set(this.$index,val)}};var second={$last:1,$first:1,$index:1};var proxy=modelFactory(source,second);var e=proxy.$events;e[name]=e.$first=e.$last=e.$index;proxy.$id=generateID("$proxy$each");return proxy}function eachProxyAgent(index,data){var param=data.param||"el",proxy;for(var i=0,n=eachProxyPool.length;i<n;i++){var candidate=eachProxyPool[i];if(candidate&&candidate.hasOwnProperty(param)){proxy=candidate;eachProxyPool.splice(i,1)}}if(!proxy){proxy=eachProxyFactory(param)}var host=data.$repeat;var last=host.length-1;proxy.$index=index;proxy.$first=index===0;proxy.$last=index===last;proxy.$host=host;proxy.$outer=data.$outer;proxy.$stamp=data.clone.cloneNode(false);proxy.$remove=function(){return host.removeAt(proxy.$index)};return proxy}function withProxyFactory(){var proxy=modelFactory({$key:"",$outer:{},$host:{},$val:{get:function(){return this.$host[this.$key]},set:function(val){this.$host[this.$key]=val}}},{$val:1});proxy.$id=generateID("$proxy$with");return proxy}function withProxyAgent(key,data){var proxy=withProxyPool.pop();if(!proxy){proxy=withProxyFactory()}var host=data.$repeat;proxy.$key=key;proxy.$host=host;proxy.$outer=data.$outer;if(host.$events){proxy.$events.$val=host.$events[key]}else{proxy.$events={}}return proxy}function recycleProxies(proxies,type){var proxyPool=type==="each"?eachProxyPool:withProxyPool;avalon.each(proxies,function(key,proxy){if(proxy.$events){for(var i in proxy.$events){if(Array.isArray(proxy.$events[i])){proxy.$events[i].forEach(function(data){if(typeof data==="object"){disposeData(data)}});proxy.$events[i].length=0}}proxy.$host=proxy.$outer={};if(proxyPool.unshift(proxy)>kernel.maxRepeatSize){proxyPool.pop()}}});if(type==="each"){proxies.length=0}}var rscripts=/<script[^>]*>([\S\s]*?)<\/script\s*>/gim;var ron=/\s+(on[^=\s]+)(?:=("[^"]*"|'[^']*'|[^\s>]+))?/g;var ropen=/<\w+\b(?:(["'])[^"]*?(\1)|[^>])*>/ig;var rsanitize={a:/\b(href)\=("javascript[^"]*"|'javascript[^']*')/ig,img:/\b(src)\=("javascript[^"]*"|'javascript[^']*')/ig,form:/\b(action)\=("javascript[^"]*"|'javascript[^']*')/ig};var rsurrogate=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g;var rnoalphanumeric=/([^\#-~| |!])/g;function numberFormat(number,decimals,dec_point,thousands_sep){number=(number+"").replace(/[^0-9+\-Ee.]/g,"");var n=!isFinite(+number)?0:+number,prec=!isFinite(+decimals)?0:Math.abs(decimals),sep=(typeof thousands_sep==="undefined")?",":thousands_sep,dec=(typeof dec_point==="undefined")?".":dec_point,s="",toFixedFix=function(n,prec){var k=Math.pow(10,prec);return""+(Math.round(n*k)/k).toFixed(prec)};s=(prec?toFixedFix(n,prec):""+Math.round(n)).split(".");if(s[0].length>3){s[0]=s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,sep)}if((s[1]||"").length<prec){s[1]=s[1]||"";s[1]+=new Array(prec-s[1].length+1).join("0")}return s.join(dec)}var filters=avalon.filters={uppercase:function(str){return str.toUpperCase()},lowercase:function(str){return str.toLowerCase()},truncate:function(str,length,truncation){length=length||30;truncation=truncation===void (0)?"...":truncation;return str.length>length?str.slice(0,length-truncation.length)+truncation:String(str)},$filter:function(val){for(var i=1,n=arguments.length;i<n;i++){var array=arguments[i];var fn=avalon.filters[array.shift()];if(typeof fn==="function"){var arr=[val].concat(array);val=fn.apply(null,arr)}}return val},camelize:camelize,sanitize:function(str){return str.replace(rscripts,"").replace(ropen,function(a,b){var match=a.toLowerCase().match(/<(\w+)\s/);if(match){var reg=rsanitize[match[1]];if(reg){a=a.replace(reg,function(s,name,value){var quote=value.charAt(0);return name+"="+quote+"javascript:void(0)"+quote})}}return a.replace(ron," ").replace(/\s+/g," ")})},escape:function(str){return String(str).replace(/&/g,"&amp;").replace(rsurrogate,function(value){var hi=value.charCodeAt(0);var low=value.charCodeAt(1);return"&#"+(((hi-55296)*1024)+(low-56320)+65536)+";"}).replace(rnoalphanumeric,function(value){return"&#"+value.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")},currency:function(amount,symbol,fractionSize){return(symbol||"\uFFE5")+numberFormat(amount,isFinite(fractionSize)?fractionSize:2)
    },number:function(number,fractionSize){return numberFormat(number,isFinite(fractionSize)?fractionSize:3)}};new function(){function toInt(str){return parseInt(str,10)}function padNumber(num,digits,trim){var neg="";if(num<0){neg="-";num=-num}num=""+num;while(num.length<digits){num="0"+num}if(trim){num=num.substr(num.length-digits)}return neg+num}function dateGetter(name,size,offset,trim){return function(date){var value=date["get"+name]();if(offset>0||value>-offset){value+=offset}if(value===0&&offset===-12){value=12}return padNumber(value,size,trim)}}function dateStrGetter(name,shortForm){return function(date,formats){var value=date["get"+name]();var get=(shortForm?("SHORT"+name):name).toUpperCase();return formats[get][value]}}function timeZoneGetter(date){var zone=-1*date.getTimezoneOffset();var paddedZone=(zone>=0)?"+":"";paddedZone+=padNumber(Math[zone>0?"floor":"ceil"](zone/60),2)+padNumber(Math.abs(zone%60),2);return paddedZone}function ampmGetter(date,formats){return date.getHours()<12?formats.AMPMS[0]:formats.AMPMS[1]}var DATE_FORMATS={yyyy:dateGetter("FullYear",4),yy:dateGetter("FullYear",2,0,true),y:dateGetter("FullYear",1),MMMM:dateStrGetter("Month"),MMM:dateStrGetter("Month",true),MM:dateGetter("Month",2,1),M:dateGetter("Month",1,1),dd:dateGetter("Date",2),d:dateGetter("Date",1),HH:dateGetter("Hours",2),H:dateGetter("Hours",1),hh:dateGetter("Hours",2,-12),h:dateGetter("Hours",1,-12),mm:dateGetter("Minutes",2),m:dateGetter("Minutes",1),ss:dateGetter("Seconds",2),s:dateGetter("Seconds",1),sss:dateGetter("Milliseconds",3),EEEE:dateStrGetter("Day"),EEE:dateStrGetter("Day",true),a:ampmGetter,Z:timeZoneGetter};var DATE_FORMATS_SPLIT=/((?:[^yMdHhmsaZE']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z))(.*)/,NUMBER_STRING=/^\d+$/;var riso8601=/^(\d{4})-?(\d+)-?(\d+)(?:T(\d+)(?::?(\d+)(?::?(\d+)(?:\.(\d+))?)?)?(Z|([+-])(\d+):?(\d+))?)?$/;function jsonStringToDate(string){var match;if(match=string.match(riso8601)){var date=new Date(0),tzHour=0,tzMin=0,dateSetter=match[8]?date.setUTCFullYear:date.setFullYear,timeSetter=match[8]?date.setUTCHours:date.setHours;if(match[9]){tzHour=toInt(match[9]+match[10]);tzMin=toInt(match[9]+match[11])}dateSetter.call(date,toInt(match[1]),toInt(match[2])-1,toInt(match[3]));var h=toInt(match[4]||0)-tzHour;var m=toInt(match[5]||0)-tzMin;var s=toInt(match[6]||0);var ms=Math.round(parseFloat("0."+(match[7]||0))*1000);timeSetter.call(date,h,m,s,ms);return date}return string}var rfixYMD=/^(\d+)\D(\d+)\D(\d+)/;filters.date=function(date,format){var locate=filters.date.locate,text="",parts=[],fn,match;format=format||"mediumDate";format=locate[format]||format;if(typeof date==="string"){if(NUMBER_STRING.test(date)){date=toInt(date)}else{var trimDate=date.trim();date=trimDate.replace(rfixYMD,function(a,b,c,d){var array=d.length===4?[d,b,c]:[b,c,d];return array.join("-")});date=jsonStringToDate(date)}date=new Date(date)}if(typeof date==="number"){date=new Date(date)}if(avalon.type(date)!=="date"){return}while(format){match=DATE_FORMATS_SPLIT.exec(format);if(match){parts=parts.concat(match.slice(1));format=parts.pop()}else{parts.push(format);format=null}}parts.forEach(function(value){fn=DATE_FORMATS[value];text+=fn?fn(date,locate):value.replace(/(^'|'$)/g,"").replace(/''/g,"'")});return text};var locate={AMPMS:{0:"上午",1:"下午"},DAY:{0:"星期日",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},MONTH:{0:"1月",1:"2月",2:"3月",3:"4月",4:"5月",5:"6月",6:"7月",7:"8月",8:"9月",9:"10月",10:"11月",11:"12月"},SHORTDAY:{"0":"周日","1":"周一","2":"周二","3":"周三","4":"周四","5":"周五","6":"周六"},fullDate:"y年M月d日EEEE",longDate:"y年M月d日",medium:"yyyy-M-d H:mm:ss",mediumDate:"yyyy-M-d",mediumTime:"H:mm:ss","short":"yy-M-d ah:mm",shortDate:"yy-M-d",shortTime:"ah:mm"};locate.SHORTMONTH=locate.MONTH;filters.date.locate=locate};var modules=avalon.modules={"ready!":{exports:avalon},"avalon":{exports:avalon,state:2}};modules.exports=modules.avalon;new function(){var loadings=[];var factorys=[];var rjsext=/\.js$/i;innerRequire=avalon.require=function(array,factory,parentUrl){if(!Array.isArray(array)){avalon.error("require的第一个参数必须是依赖列数,类型为数组 "+array)}var args=[];var deps={};var id=parentUrl||"callback"+setTimeout("1");var mapUrl=parentUrl&&parentUrl.replace(rjsext,"");parentUrl=getBaseUrl(parentUrl);array.forEach(function(el){var url=loadResources(el,parentUrl,mapUrl);if(url){if(!deps[url]){args.push(url);deps[url]="司徒正美"}}});var module=modules[id];if(!module||module.state!==2){modules[id]=makeModule(id,1,factory,deps,args)}if(!module){loadings.push(id)}checkDeps()};innerRequire.define=function(urlOrId,deps,factory){var args=aslice.call(arguments);if(typeof urlOrId==="string"){var id=args.shift()}if(typeof args[0]==="function"){args.unshift([])}var url=modules[id]&&modules[id].state>=1?id:trimQuery(getCurrentScript());factory=args[1];factory.id=id;if(!modules[url]&&id){modules[url]=makeModule(url,1,factory)}factory.require=function(url){args.push(url);var isCycle=true;try{isCycle=checkCycle(modules[url].deps,url)}catch(e){}if(isCycle){avalon.error(url+"模块与之前的模块存在循环依赖，请不要直接用script标签引入"+url+"模块")
    }delete factory.require;innerRequire.apply(null,args)};if(url){factory.require(url)}else{factorys.push(factory)}};innerRequire.config=kernel;innerRequire.define.amd=modules;var allpaths=kernel["orig.paths"]={};var allmaps=kernel["orig.map"]={};var allpackages=kernel["packages"]=[];var allargs=kernel["orig.args"]={};avalon.mix(plugins,{paths:function(hash){avalon.mix(allpaths,hash);kernel.paths=makeIndexArray(allpaths)},map:function(hash){avalon.mix(allmaps,hash);var list=makeIndexArray(allmaps,1,1);avalon.each(list,function(_,item){item.val=makeIndexArray(item.val)});kernel.map=list},packages:function(array){array=array.concat(allpackages);var uniq={};var ret=[];for(var i=0,pkg;pkg=array[i++];){var pkg=typeof pkg==="string"?{name:pkg}:pkg;var name=pkg.name;if(!uniq[name]){var url=pkg.location?pkg.location:joinPath(name,pkg.main||"main");url=url.replace(rjsext,"");ret.push(pkg);uniq[name]=pkg.location=url;pkg.reg=makeMatcher(name)}}kernel.packages=ret.sort()},urlArgs:function(hash){if(typeof hash==="string"){hash={"*":hash}}avalon.mix(allargs,hash);kernel.urlArgs=makeIndexArray(allargs,1)},baseUrl:function(url){if(!isAbsUrl(url)){var baseElement=head.getElementsByTagName("base")[0];if(baseElement){head.removeChild(baseElement)}var node=DOC.createElement("a");node.href=url;url="1"[0]?node.href:node.getAttribute("href",4);if(baseElement){head.insertBefore(baseElement,head.firstChild)}}kernel.baseUrl=url},shim:function(obj){for(var i in obj){var value=obj[i];if(Array.isArray(value)){value=obj[i]={deps:value}}if(!value.exportsFn&&(value.exports||value.init)){value.exportsFn=makeShimExports(value)}}kernel.shim=obj}});function checkCycle(deps,nick){for(var id in deps){if(deps[id]==="司徒正美"&&modules[id].state!==2&&(id===nick||checkCycle(modules[id].deps,nick))){return true}}}function checkFail(node,onError,fuckIE){var id=trimQuery(node.src);node.onload=node.onreadystatechange=node.onerror=null;if(onError||(fuckIE&&!modules[id].state)){setTimeout(function(){head.removeChild(node);node=null});log("debug: 加载 "+id+" 失败"+onError+" "+(!modules[id].state))}else{return true}}function checkDeps(){loop:for(var i=loadings.length,id;id=loadings[--i];){var obj=modules[id],deps=obj.deps;for(var key in deps){if(ohasOwn.call(deps,key)&&modules[key].state!==2){continue loop}}if(obj.state!==2){loadings.splice(i,1);fireFactory(obj.id,obj.args,obj.factory);checkDeps()}}}var resources=innerRequire.plugins={ready:{load:noop},js:{load:function(name,req,onLoad){var url=req.url;var id=trimQuery(url);var shim=kernel.shim[name.replace(rjsext,"")];if(shim){innerRequire(shim.deps||[],function(){var args=avalon.slice(arguments);loadJS(url,id,function(){onLoad(shim.exportsFn?shim.exportsFn.apply(0,args):void 0)})})}else{loadJS(url,id)}}},css:{load:function(name,req,onLoad){var url=req.url;var id=trimQuery(url).replace(/\W/g,"");if(!DOC.getElementById(id)){var node=DOC.createElement("link");node.rel="stylesheet";node.href=url;node.id=id;head.insertBefore(node,head.firstChild);onLoad()}}},text:{load:function(name,req,onLoad){var url=req.url;var xhr=getXHR();xhr.onreadystatechange=function(){if(xhr.readyState===4){var status=xhr.status;if(status>399&&status<600){avalon.error(url+" 对应资源不存在或没有开启 CORS")}else{onLoad(xhr.responseText)}}};xhr.open("GET",url,true);if("withCredentials" in xhr){xhr.withCredentials=true}xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");xhr.send()}}};innerRequire.checkDeps=checkDeps;var rquery=/(\?[^#]*)$/;function trimQuery(url){return(url||"").replace(rquery,"")}function isAbsUrl(path){return/^(?:[a-z]+:)?\/\//i.test(String(path))}function getBaseUrl(parentUrl){return parentUrl?parentUrl.substr(0,parentUrl.lastIndexOf("/")):kernel.baseUrl?kernel.baseUrl:kernel.loaderUrl}function getCurrentScript(base){var stack;try{a.b.c()}catch(e){stack=e.stack;if(!stack&&window.opera){stack=(String(e).match(/of linked script \S+/g)||[]).join(" ")}}if(stack){stack=stack.split(/[@ ]/g).pop();stack=stack[0]==="("?stack.slice(1,-1):stack.replace(/\s/,"");return stack.replace(/(:\d+)?:\d+$/i,"")}var nodes=(base?DOC:head).getElementsByTagName("script");for(var i=nodes.length,node;node=nodes[--i];){if((base||node.className===subscribers)&&node.readyState==="interactive"){var url="1"[0]?node.src:node.getAttribute("src",4);return node.className=url}}}function loadResources(url,parentUrl,mapUrl){if(modules[url]&&modules[url].state===2){return url}var res="js";url=url.replace(/^(\w+)\!/,function(a,b){res=b;return""});var req={toUrl:toUrl,parentUrl:parentUrl,mapUrl:mapUrl,res:res};var urlNoQuery=url&&trimQuery(req.toUrl(url));if(url&&!modules[urlNoQuery]){var module=modules[urlNoQuery]=makeModule(urlNoQuery);function wrap(obj){resources[res]=obj;obj.load(url,req,function(a){if(arguments.length&&a!==void 0){module.exports=a}module.state=2;innerRequire.checkDeps()})}if(!resources[res]){innerRequire([res],wrap)}else{wrap(resources[res])}}return url?urlNoQuery:res+"!"}function toUrl(url){var query="";var id=url.replace(rquery,function(a){query=a;return""
    });var res="."+this.res;var ext=/js|css/.test(res)?res:"";url=id=id.replace(/\.[a-z0-9]+$/g,function(a){if(a===res){ext=a;return""}else{return a}});this.id=id;var usePath=0;eachIndexArray(id,kernel.paths,function(value,key){url=url.replace(key,value);usePath=1});if(!usePath){eachIndexArray(id,kernel.packages,function(value,key,item){url=url.replace(item.name,item.location)})}if(this.mapUrl){eachIndexArray(this.mapUrl,kernel.map,function(array){eachIndexArray(url,array,function(mdValue,mdKey){url=url.replace(mdKey,mdValue)})})}if(!isAbsUrl(url)){url=joinPath(/\w/.test(url.charAt(0))?getBaseUrl():this.parentUrl,url)}url+=ext+query;eachIndexArray(id,kernel.urlArgs,function(value){url+=(url.indexOf("?")===-1?"?":"&")+value});return this.url=url}function loadJS(url,id,callback){var node=DOC.createElement("script");node.className=subscribers;node[W3C?"onload":"onreadystatechange"]=function(){if(W3C||/loaded|complete/i.test(node.readyState)){var factory=factorys.pop();factory&&factory.require(id);if(callback){callback()}if(checkFail(node,false,!W3C)){log("debug: 已成功加载 "+url);loadings.push(id);checkDeps()}}};node.onerror=function(){checkFail(node,true)};node.src=url;head.insertBefore(node,head.firstChild);log("debug: 正准备加载 "+url)}function fireFactory(id,deps,factory){var module=Object(modules[id]);module.state=2;for(var i=0,array=[],d;d=deps[i++];){if(d==="exports"){var obj=module.exports||(module.exports={});array.push(obj)}else{array.push(modules[d].exports)}}var ret=factory.apply(window,array);if(ret!==void 0){modules[id].exports=ret}return ret}function makeIndexArray(hash,useStar,part){var index=hash2array(hash,useStar,part);index.sort(descSorterByName);return index}function makeMatcher(prefix){return new RegExp("^"+prefix+"(/|$)")}function makeShimExports(value){return function(){var ret;if(value.init){ret=value.init.apply(window,arguments)}return ret||(value.exports&&getGlobal(value.exports))}}function makeModule(id,state,factory,deps,args){return{id:id,state:state||1,factory:factory||noop,deps:deps||{},args:args||[]}}function hash2array(hash,useStar,part){var array=[];for(var key in hash){if(hash.hasOwnProperty(key)){var item={name:key,val:hash[key]};array.push(item);item.reg=key==="*"&&useStar?/^/:makeMatcher(key);if(part&&key!=="*"){item.reg=new RegExp("/"+key.replace(/^\//,"")+"(/|$)")}}}return array}function eachIndexArray(moduleID,array,matcher){array=array||[];for(var i=0,el;el=array[i++];){if(el.reg.test(moduleID)){matcher(el.val,el.name,el);return false}}}function descSorterByName(a,b){var aaa=a.name;var bbb=b.name;if(bbb==="*"){return -1}if(aaa==="*"){return 1}return bbb.length-aaa.length}var rdeuce=/\/\w+\/\.\./;function joinPath(a,b){if(a.charAt(a.length-1)!=="/"){a+="/"}if(b.slice(0,2)==="./"){return a+b.slice(2)}if(b.slice(0,2)===".."){a+=b;while(rdeuce.test(a)){a=a.replace(rdeuce,"")}return a}if(b.slice(0,1)==="/"){return a+b.slice(1)}return a+b}function getGlobal(value){if(!value){return value}var g=window;value.split(".").forEach(function(part){g=g[part]});return g}var cur=getCurrentScript(true);if(!cur){cur=DOC.scripts[DOC.scripts.length-1].src}var url=trimQuery(cur);kernel.loaderUrl=url.slice(0,url.lastIndexOf("/")+1)};var readyList=[];function fireReady(){if(DOC.body){if(innerRequire){modules["ready!"].state=2;innerRequire.checkDeps()}else{readyList.forEach(function(a){a(avalon)})}fireReady=noop}}function doScrollCheck(){try{root.doScroll("left");fireReady()}catch(e){setTimeout(doScrollCheck)}}if(DOC.readyState==="complete"){setTimeout(fireReady)}else{if(W3C){DOC.addEventListener("DOMContentLoaded",fireReady)}else{DOC.attachEvent("onreadystatechange",function(){if(DOC.readyState==="complete"){fireReady()}});var isFrame;try{isFrame=window.frameElement!=null}catch(e){isFrame=true}if(root.doScroll&&!isFrame){doScrollCheck()}}}avalon.bind(window,"load",fireReady);avalon.ready=function(fn){if(innerRequire){innerRequire(["ready!"],fn)}else{if(fireReady===noop){fn(avalon)}else{readyList.push(fn)}}};avalon.config({loader:true});avalon.ready(function(){avalon.scan(DOC.body)});if(typeof define==="function"&&define.amd){define("avalon",[],function(){return avalon})}var _avalon=window.avalon;avalon.noConflict=function(deep){if(deep&&window.avalon===avalon){window.avalon=avalon}return avalon};if(noGlobal===void 0){window.avalon=avalon}return avalon}));